<?xml version="1.0" encoding="utf-8"?>


<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-US">
    <title type="text">MrSheep&#39;s Blog</title>
    <subtitle type="html">Personal Blog from MrSheep.</subtitle>
    <updated>2020-04-23T19:52:33+08:00</updated>
    <id>https://blog.mrsheep.xyz/</id>
    <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/" />
    <link rel="self" type="application/atom+xml" href="https://blog.mrsheep.xyz/atom.xml" />
    <author>
            <name>MrSheep</name>
            <uri>https://blog.mrsheep.xyz/</uri>
            
                <email>admin@mrsheep.xyz</email>
            </author>
    <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights>
    <generator uri="https://gohugo.io/" version="0.67.1">Hugo</generator>
        <entry>
            <title type="text">Ros Chr</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/ros-chr/" />
            <id>https://blog.mrsheep.xyz/posts/ros-chr/</id>
            <updated>2020-04-23T19:27:22+08:00</updated>
            <published>2020-04-23T18:48:40+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[本文主要是記錄一下如何dd安裝ROS CHR並配置好IPv4和IPv6]]></summary>
            
                <content type="html"><![CDATA[<p>本文主要是記錄一下如何dd安裝ROS CHR並配置好IPv4和IPv6</p>
<h1 id="安裝ros">安裝ROS</h1>
<h2 id="systemrescuecd">SystemRescueCD</h2>
<p>在你的vps提供商的面板處上傳SystemRescueCD的鏡像，複製連接地址即可：</p>
<table>
<thead>
<tr>
<th>Release</th>
<th>SystemRescueCd-6.1.3 for amd64</th>
<th>SystemRescueCd-6.1.3 for i686</th>
</tr>
</thead>
<tbody>
<tr>
<td>Download ISO</td>
<td><a href="https://osdn.net/projects/systemrescuecd/storage/releases/6.1.3/systemrescuecd-amd64-6.1.3.iso">systemrescuecd-amd64-6.1.3.iso</a></td>
<td><a href="https://osdn.net/projects/systemrescuecd/storage/releases/6.1.3/systemrescuecd-i686-6.1.3.iso">systemrescuecd-i686-6.1.3.iso</a></td>
</tr>
</tbody>
</table>
<p>或者例如vultr這類服務商會提供SystemRescueCD</p>
<h2 id="dd系統">DD系統</h2>
<ol>
<li>
<p>VNC登入VPS，選擇<code>Boot SystemRescueCd using default options</code></p>
</li>
<li>
<p>進入系統後使用<code>passwd</code>重置密碼，可以使用ssh連線伺服器（方便複製粘貼）</p>
<p>ssh登入以後，執行</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">root@sysresccd ~]# wget https://download.mikrotik.com/routeros/6.45.8/chr-6.45.8.img.zip
# 請在mikrotik官網獲取最新版本CHR Raw Disk Image

[root@sysresccd ~]# unzip chr-6.45.8.img.zip 
[root@sysresccd ~]# dd if=chr-6.45.8.img of=/dev/vda 
[root@sysresccd ~]# mount /dev/vda1 /mnt/
[root@sysresccd ~]# cat &gt; /mnt/rw/autorun.scr &lt;&lt; EOF
# Auto configure script on RouterOS first boot
# feel free to customize it if you really need
/ip address add address=[你的vps ip]/22 interface=ether1 network=route
# 在ipinfo.io/your_ip可以獲得對應的route
/ip route add distance=1 gateway=閘道
/ip service
set telnet port=23023
set ftp disabled=yes
set ssh disabled=yes
set api disabled=yes
set api-ssl disabled=yes
/ip dns set servers=1.1.1.1,1.0.0.1
EOF
[root@sysresccd ~]# umount /mnt/
[root@sysresccd ~]# reboot 
# 重啓後即安裝完成

</code></pre></td></tr></table>
</div>
</div><p><strong>注意：請記得移除之前上傳的iso</strong></p>
<h1 id="ipv6">IPv6</h1>
<p>ROS沒有辦法正常找到類似vultr等的默認gateway，ping一下<code>ff02::2</code>，fe80開頭的地址就是你的網關了</p>
<p>打開terminal</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/ipv6 settings set forward=no
/ipv6 address add interface=ether1 address=你的ipv6/64
/ipv6 route add dst-address=::/0 gateway=網關地址%ether1
/ipv6 nd set [ find default=yes ] hop-limit=64 interface=ether1 managed-address-configuration=yes other-configuration=yes
</code></pre></td></tr></table>
</div>
</div><h1 id="參考">參考</h1>
<p><a href="https://www.vultr.com/docs/install-mikrotik-routeros-on-a-vultr-instance">Install MikroTik RouterOS on a Vultr VPS</a></p>
<p><a href="https://blog.ni-co.moe/public/572.html">vyos 配置和 bgp 宣告 ipv6 (vyos: 从入门到放弃</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Nftables Forward</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/nftables-forward/" />
            <id>https://blog.mrsheep.xyz/posts/nftables-forward/</id>
            <updated>2020-04-10T09:08:59+08:00</updated>
            <published>2020-04-10T08:42:34+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[之前寫過直接使用V2Ray的鏈式轉發實現中轉的文章，傳送門
但是最近在嘗試配置v2Board的時候，我沒辦法直接編輯配置文件，所以就另想辦法]]></summary>
            
                <content type="html"><![CDATA[<p>之前寫過直接使用V2Ray的鏈式轉發實現中轉的文章，<a href="https://blog.mrsheep.xyz/posts/v2ray-fw/">傳送門</a></p>
<p>但是最近在嘗試配置v2Board的時候，我沒辦法直接編輯配置文件，所以就另想辦法</p>
<h1 id="nftables">nftables</h1>
<h2 id="什麼是nftables">什麼是nftables？</h2>
<blockquote>
<p><strong>nftables</strong> replaces the popular <strong>{ip,ip6,arp,eb}tables</strong>. This software provides a new in-kernel packet classification framework  that is based on a network-specific Virtual Machine (VM) and a new <strong>nft</strong> userspace command line tool. <strong>nftables</strong> reuses the existing Netfilter subsystems such as the existing hook  infrastructure, the connection tracking system, NAT, userspace queueing  and logging subsystem.</p>
<p>This software also provides <strong>libnftables</strong>, the high-level userspace library that includes support for JSON, see man (3)libnftables for more information.</p>
</blockquote>
<p>Google Transalate結果如下：</p>
<blockquote>
<p>** nftables **取代了流行的** {ip，ip6，arp，eb}桌子**。 該軟件提供了一個新的內核數據包分類框架，該框架基於特定於網絡的虛擬機（VM）和新的** nft **用戶空間命令行工具。 ** nftables **重用了現有的Netfilter子系統，例如現有的hook基礎結構，連接跟踪系統，NAT，用戶空間排隊和日誌記錄子系統。</p>
<p>該軟件還提供** libnftables **，這是高級用戶空間庫，其中包括對JSON的支持，有關更多信息，請參見man（3）libnftables。</p>
</blockquote>
<h2 id="配置">配置</h2>
<h3 id="準備工作">準備工作</h3>
<h4 id="關閉原有防火牆">關閉原有防火牆</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">systemctl stop firewalld
systemctl stop iptables
systemctl disable firewalld
systemctl disable iptables
</code></pre></td></tr></table>
</div>
</div><h4 id="禁用selinuxcentos">禁用selinux（CentOS）</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">setenforce 0
sed -i &#39;s/SELINUX=enforcing/SELINUX=disabled/&#39; /etc/selinux/config  
</code></pre></td></tr></table>
</div>
</div><h4 id="開啓端口轉發">開啓端口轉發</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">echo -e &#34;net.ipv4.ip_forward=1&#34; &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p
</code></pre></td></tr></table>
</div>
</div><h3 id="手動配置不推薦">手動配置（不推薦）</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">nft add set ip nat { type ipv4_addr\; }
nft add rule ip nat POSTROUTING ip daddr 目標ip tcp dport 443 counter snat to 本機ip
add rule ip nat POSTROUTING ip daddr 目標ip udp dport 443 counter snat to 本機ip
</code></pre></td></tr></table>
</div>
</div><h3 id="nftables-nat规则生成工具推薦">nftables nat规则生成工具(推薦)</h3>
<p>Github項目： <a href="https://github.com/arloor/nftables-nat-rust">nftables-nat-rust</a></p>
<p>root運行以下命令</p>
<h4 id="優點">優點</h4>
<ul>
<li>適合動態ip，自動解析ddns</li>
<li>支持域名</li>
<li>自動檢測本機ip</li>
<li>支持端口段</li>
</ul>
<h4 id="下載安裝">下載安裝</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wget -O /usr/local/bin/nat http://cdn.arloor.com/tool/dnat
chmod +x /usr/local/bin/nat
</code></pre></td></tr></table>
</div>
</div><h4 id="配置文件">配置文件</h4>
<p>配置文件位於<code>/etc/nat.conf</code></p>
<p>每行代表一個規則</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SINGLE,本機端口,目標端口,mrsheep.xyz
RANGE,本機端口起,本機端口末,mrsheep.xyz
</code></pre></td></tr></table>
</div>
</div><ul>
<li>SINGLE：单端口转发：本机49999端口转发到baidu.com:59999</li>
<li>RANGE：范围端口转发：本机50000-50010转发到baidu.com:50000-50010</li>
</ul>
<h4 id="注意事項">注意事項</h4>
<ul>
<li>不支持多网卡</li>
</ul>
<h1 id="參考">參考</h1>
<p><a href="https://github.com/arloor/nftables-nat-rust">nftables-nat-rust</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Vlan Iptv</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/multiplexing-iptv/" />
            <id>https://blog.mrsheep.xyz/posts/multiplexing-iptv/</id>
            <updated>2020-04-10T08:45:10+08:00</updated>
            <published>2020-04-07T22:57:20+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[還是上次的朋友，他家裏的一間房間裏僅有1個RJ45口，但是想在不損失網線性能，即不拆分爲4芯線的同時播放中國電信的iptv和進行網頁瀏覽。
剛好他家裡有ROS和一臺本來用於監控的GS105E，那就搞個vlan來玩玩唄]]></summary>
            
                <content type="html"><![CDATA[<p>還是上次的朋友，他家裏的一間房間裏僅有1個RJ45口，但是想在不損失網線性能，即不拆分爲4芯線的同時播放中國電信的iptv和進行網頁瀏覽。</p>
<p>剛好他家裡有ROS和一臺本來用於監控的GS105E，那就搞個vlan來玩玩唄</p>
<h1 id="前言">前言</h1>
<h2 id="vlan">VLan？</h2>
<p>根據維基詞條 <a href="https://zh.wikipedia.org/zh-tw/%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91">虛擬區域網路</a>的解釋：</p>
<blockquote>
<p><strong>虛擬區域網路</strong>（<strong>Virtual Local Area Network</strong>或簡寫<strong>VLAN</strong>, <strong>V-LAN</strong>）是一種建構於區域網路交換技術（LAN Switch）的<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E7%B5%A1%E7%AE%A1%E7%90%86">網路管理</a>的技術，網管人員可以藉此透過控制<a href="https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%8F%9B%E5%99%A8">交換器</a>有效分派出入區域網的封包到正確的出入埠，達到對不同實體區域網中的裝置進行邏輯分群（Grouping）管理，並降低區域網內大量資料流通時，因無用封包過多導致壅塞的問題，以及提昇區域網的資訊安全保障</p>
</blockquote>
<p>Vlan是一個虛擬的Lan，將一個實體的Lan分割成多個Vlan使用，分割出來的Vlan各自獨立且不能相互通訊。本文基於802.1q</p>
<h2 id="多工">多工？</h2>
<p>一樣是維基百科：</p>
<blockquote>
<p><strong>多路複用</strong>（Multiplexing，又稱「<strong>多工</strong>」）是一個<a href="https://zh.wikipedia.org/wiki/%E9%80%9A%E4%BF%A1">通訊</a>和<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">計算機網路</a>領域的專業<a href="https://zh.wikipedia.org/wiki/%E6%9C%AF%E8%AF%AD">術語</a>，在沒有歧義的情況下，「多路複用」也可被稱為「複用」。多路複用通常表示在一個<a href="https://zh.wikipedia.org/wiki/%E4%BF%A1%E9%81%93">通道</a>上<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93">傳輸</a>多路<a href="https://zh.wikipedia.org/wiki/%E4%BF%A1%E5%8F%B7">訊號</a>或<a href="https://zh.wikipedia.org/w/index.php?title=%E6%95%B0%E6%8D%AE%E6%B5%81&amp;action=edit&amp;redlink=1">數據流</a>的過程和技術。因為多路複用能夠將多個低速通道整合到一個高速通道進行傳輸，從而有效地利用了高速通道。通過使用多路複用，<a href="https://zh.wikipedia.org/w/index.php?title=%E9%80%9A%E4%BF%A1%E8%BF%90%E8%90%A5%E5%95%86&amp;action=edit&amp;redlink=1">通訊運營商</a>可以避免維護多條線路，從而有效地節約運營成本。[<a href="https://zh.wikipedia.org/zh-tw/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8#cite_note-1">1]</a></p>
</blockquote>
<p>其抽象模型見下圖</p>
<p><img src="https://i.loli.net/2020/04/07/zaO2BEdXJQGsC3K.png" alt="Mux_color.png"></p>
<h2 id="trunking">Trunking?</h2>
<p>還是維基百科：</p>
<blockquote>
<p>中繼**（Trunking）**是一個藉由分享一段相同的線路或是頻率而不是單獨提供它們，來提供網路連接給眾多用戶的方法，類似於樹幹與許多樹枝的結構。此方法被廣泛的運用於電話系統、常用於警察機關的雙向無線電，以及網際網路中。</p>
<p>主幹（trunk）是兩端點中的單一傳輸頻道，端點都是交換中心（switching center）或是節點（node）。</p>
</blockquote>
<h2 id="其他解決辦法">其他解決辦法</h2>
<p>其實並不是沒有其他的解決方法，比如說：</p>
<ul>
<li>8芯改爲4芯，僅100mbps速度</li>
<li>重新埋，想想就不現實</li>
<li>EOC？算了吧，本來就沒有</li>
</ul>
<h1 id="設備">設備</h1>
<h2 id="需要的設備">需要的設備</h2>
<ul>
<li>支持802.1q vlan劃分的交換機/路由器</li>
<li>網線</li>
<li>腦子</li>
<li>筆電</li>
</ul>
<h2 id="網路拓撲">網路拓撲</h2>
<p>因爲懶就不製圖了</p>
<p>簡單的來說就是將Modern的iptv口和internet口都接入到主路由上。iptv接入ether 9，ether5 作爲trunk口連結至需要的房間中的gs105e的port 5</p>
<p>gs105e的port 1留給iptv</p>
<h1 id="配置">配置</h1>
<h2 id="switch">Switch</h2>
<h3 id="配置程式">配置程式</h3>
<p>Netgear的交換機請前往<a href="https://www.netgear.com/support/product/GS105Ev2.aspx#docs">官方網站</a>獲取 <a href="https://www.netgear.com/support/product/GS105Ev2.aspx#ProSAFE%20Plus%20Configuration%20Utility%20v2.7.7">ProSAFE Plus Config Utility</a></p>
<p>(這個真心難用)</p>
<h3 id="關閉igmp並開啓vlan">關閉iGMP並開啓VLAN</h3>
<p>系統 &ndash;&gt; 組播 &ndash;&gt; IGMP 偵聽 &ndash;&gt; IGMP偵聽狀態： <strong>關閉IGMP</strong></p>
<p>Vlan &ndash;&gt; 802.1q VLAN &ndash;&gt; 高級設定 &ndash;&gt;<strong>啓用</strong></p>
<h3 id="配置vlan">配置VLan</h3>
<p>添加兩個新的Vlan id，id想多少就多少，例如 2，3</p>
<p>這裏將2作爲internet的vlan，3用語iptv</p>
<p>Vlan 成員：</p>
<p>Vlan 2:</p>
<table>
<thead>
<tr>
<th>端口</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>組操作</td>
<td></td>
<td>U</td>
<td>U</td>
<td>U</td>
<td>T</td>
</tr>
</tbody>
</table>
<p>Vlan 3:</p>
<table>
<thead>
<tr>
<th>端口</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>組操作</td>
<td>U</td>
<td></td>
<td></td>
<td></td>
<td>T</td>
</tr>
</tbody>
</table>
<p>關於tag和untagged，有興趣參考：<a href="https://gtacknowledge.extremenetworks.com/articles/Q_A/What-are-tagged-and-untagged-ports">What are tagged and untagged ports</a> 以及 [<a href="https://blog.miniasp.com/post/2011/02/16/Understanding-Switch-VLAN-Tagged-Untagged">釐清網管型Switch 裡與VLAN + Tag + Untag 之間的觀念| The Will Will</a>](<a href="https://blog.miniasp.com/post/2011/02/16/Understanding-Switch-VLAN-Tagged-Untagged">https://blog.miniasp.com/post/2011/02/16/Understanding-Switch-VLAN-Tagged-Untagged</a>)</p>
<h3 id="配置pvid">配置PVID</h3>
<p>Port VLAN ID需要和上面配置的Vlan id對應，即</p>
<table>
<thead>
<tr>
<th>端口</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>PVID</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
<h2 id="ros">ROS</h2>
<ul>
<li>
<p>在interface &ndash;&gt; 新建 &ndash;&gt; VLAN中新建兩條VLan，名字隨便,這裏我分別叫做IPTV-VLAN和LAN-VLAN。 vlan id分別爲Switch中配置兩個id，interface都選擇連結gs105e的端口，即ether 5</p>
</li>
<li>
<p>將ether 5與ether 9從原有bridge中移除</p>
</li>
<li>
<p>Bridge &ndash;&gt; 新建 新建橋接，名稱隨意，將iptv vlan和 iptv接入的端口橋接在一起</p>
</li>
<li>
<p>bridge &ndash;&gt; ports，新建：</p>
<ul>
<li>interface &ndash;&gt; ether 9, bridge&ndash;&gt; 你新建的橋接名字</li>
<li>interface &ndash;&gt; iptv-vlan，bridge &ndash;&gt; 橋接名字</li>
</ul>
</li>
</ul>
<p>搞定</p>
<h1 id="參考連結">參考連結</h1>
<p><a href="https://wiki.mikrotik.com/wiki/Manual:Basic_VLAN_switching">Mikrotik Manual:Basic VLAN switching</a></p>
<p><a href="https://www.arednmesh.org/content/configuring-netgear-gs105e-switch-lanwan-ports">Configuring a Netgear GS105E Switch with LAN/WAN ports</a></p>
<p><a href="https://www.reddit.com/r/homelab/comments/7mpxcm/netgear_gs108ev3_vlan_configuration/">Reddit: Netgear GS108Ev3 VLAN configuration</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">V2Board&#43;V2poseidon</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/v2board&#43;v2poseidon/" />
            <id>https://blog.mrsheep.xyz/posts/v2board&#43;v2poseidon/</id>
            <updated>2020-04-10T08:45:06+08:00</updated>
            <published>2020-04-05T22:48:01+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[本文目的在於教你如何使用免費1的前(後)端成爲一名奸商 機場主]]></summary>
            
                <content type="html"><![CDATA[<p>本文目的在於教你如何使用免費<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>的前(後)端成爲一名<del>奸商</del> 機場主</p>
<h1 id="開始之前">開始之前</h1>
<ul>
<li>採用<a href="https://github.com/v2board/v2board/">V2Board</a>作爲前端，<a href="https://github.com/ColetteContreras/v2ray-poseidon">V2-poseidon</a>作爲伺服器端</li>
<li>部分節點多個v2ray共存</li>
<li>其實配置很簡單</li>
</ul>
<h3 id="所需工具">所需工具：</h3>
<p>Debian 9 + SSH + 腦子 + 電腦</p>
<h1 id="v2board">V2Board</h1>
<h2 id="最低要求">最低要求</h2>
<p>官方推薦使用aapanel部署，環境要求如下：</p>
<table>
<thead>
<tr>
<th align="left">环境</th>
<th align="left">版本</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">php</td>
<td align="left">&gt;=7.3</td>
</tr>
<tr>
<td align="left">nginx</td>
<td align="left">&gt;=1.17</td>
</tr>
<tr>
<td align="left">mysql</td>
<td align="left">5.x</td>
</tr>
<tr>
<td align="left">redis</td>
<td align="left">☑️</td>
</tr>
</tbody>
</table>
<p>最低配置512m1c即可,其實完全可以不用aaPanel也可以順利的完成部署</p>
<h2 id="aapanel">aaPanel</h2>
<p>這個部分大多來自官方文檔：https://docs.v2board.com/deploy/aapanel.html</p>
<ol>
<li>
<p>安裝參考另一篇文章：<a href="https://blog.mrsheep.xyz/posts/aapanel/">aaPanel</a></p>
</li>
<li>
<p>安裝完成後請安裝</p>
<p>☑️ Nginx 1.17
☑️ MySQL 5.6
☑️ PHP 7.3</p>
<p>之後請繼續安裝</p>
<p>☑️ Redis
☑️ PM2
並在aaPanel 面板 &gt; App Store &gt; 找到PHP 7.3点击Setting &gt; Disabled functions 将 <code>putenv</code> <code>proc_open</code> <code>pcntl_alarm</code> <code>pcntl_signal</code> 从列表中删除</p>
</li>
<li>
<p>創建新的站點</p>
<p>aaPanel 面板 &gt; Website &gt; Add site。</p>
<blockquote>
<p>在 Domain 填入你指向服务器的域名
在 Database 选择MySQL
在 PHP Verison 选择PHP-73</p>
</blockquote>
</li>
<li>
<p>僞靜態</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nginx" data-lang="nginx"><span class="k">location</span> <span class="s">/downloads</span> <span class="p">{</span>
<span class="p">}</span>
   
<span class="k">location</span> <span class="s">/</span> <span class="p">{</span>  
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php</span><span class="nv">$is_args$query_string</span><span class="p">;</span>  
<span class="p">}</span>
   
<span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(js|css)?$</span>
<span class="p">{</span>
    <span class="kn">expires</span>      <span class="s">1h</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">access_log</span> <span class="s">/dev/null</span><span class="p">;</span> 
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h2 id="安裝v2board">安裝V2Board</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># cd到網站根目錄</span>
<span class="nb">cd</span> /www/wwwroot/example.com

<span class="c1"># 删除目录下文件</span>
chattr -i .user.ini
rm -rf .htaccess 404.html index.html .user.ini

<span class="c1"># 执行命令从 Github 克隆到当前目录。</span>
git clone https://github.com/v2board/v2board.git ./

<span class="c1"># 执行命令下载 composer.phar 到当前目录。</span>
wget https://getcomposer.org/download/1.9.0/composer.phar

<span class="c1"># 执行命令进行包安装。</span>
php composer.phar install
</code></pre></td></tr></table>
</div>
</div><p>安裝過程報錯請分配swap，詳見文章：<a href="https://blog.mrsheep.xyz/posts/linux-swap/">Swap</a></p>
<p>最後</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php">php artisan v2board:install
</code></pre></td></tr></table>
</div>
</div><p>會要求輸入數據庫地址，數據庫名，數據庫賬戶名，數據庫密碼，管理帳號，管理密碼</p>
<p>之後會提示安裝成功即可</p>
<h2 id="定時任務--隊列服務">定時任務 + 隊列服務</h2>
<h3 id="定時任務">定時任務</h3>
<p>aaPanel 面板 &gt; Cron。</p>
<blockquote>
<p>在 Type of Task 选择 Shell Script
在 Name of Task 填写 v2board
在 Period 选择 N Minutes 1 Minute
在 Script content 填写 php /www/wwwroot/domain.com/artisan schedule:run</p>
</blockquote>
<p>根据上述信息添加每1分钟执行一次的定时任务。</p>
<p>或者crontab -e加入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1 * * * * php /www/wwwroot/domain.com/artisan schedule:run &gt;/dev/null 2&gt;&amp;1
</code></pre></td></tr></table>
</div>
</div><h3 id="隊列服務">隊列服務</h3>
<p>V2board的邮件系统强依赖队列服务，你想要使用邮件验证及群发邮件必须启动队列服务。下面以aaPanel中nodejs的PM2服务来守护队列服务作为演示。</p>
<p>aaPanel 面板 &gt; App Store &gt; Deployment</p>
<p>找到PM2 Manager 4.2.2进行安装，安装完成后按照如下填写</p>
<blockquote>
<p>在 Project root directory 选择站点目录
在 Startup file name 填写 pm2.yaml
在 project name 填写 v2board</p>
</blockquote>
<p>或者自行安裝pm2:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wget -qO- https://getpm2.com/install.sh | bash
</code></pre></td></tr></table>
</div>
</div><p>然後在網站目錄下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">pm2 start pm2.yaml --name V2Board
</code></pre></td></tr></table>
</div>
</div><h2 id="env">.env</h2>
<p>在.env中設定郵件服務</p>
<p>至此部署完成</p>
<h1 id="v2-poseidon">V2-Poseidon</h1>
<h2 id="使用caddynginx接管ssl">使用Caddy/Nginx接管SSL</h2>
<p>簡單的說就是：父ws，子ws+tls就行。然后caddy弄tls</p>
<h3 id="新建父節點">新建父節點</h3>
<ul>
<li>
<p>關閉tls</p>
</li>
<li>
<p>連接端口=服務端口</p>
</li>
<li>
<p>websocket配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">    <span class="p">{</span>
      <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/example&#34;</span><span class="p">,</span>
      <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Host&#34;</span><span class="p">:</span> <span class="s2">&#34;example.com&#34;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="新建子節點">新建子節點</h3>
<ul>
<li>
<p>開啓tls</p>
</li>
<li>
<p>連接端口443</p>
</li>
<li>
<p>服務端口同上</p>
</li>
<li>
<p>WebSocket配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"> <span class="p">{</span>
      <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/example&#34;</span><span class="p">,</span>
      <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Host&#34;</span><span class="p">:</span> <span class="s2">&#34;example.com&#34;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>父節點：上面配置的父節點</p>
</li>
</ul>
<h2 id="直接運行">直接運行</h2>
<h3 id="安裝">安裝</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl -L -s https://raw.githubusercontent.com/ColetteContreras/v2ray-poseidon/master/install-release.sh <span class="p">|</span> sudo bash
</code></pre></td></tr></table>
</div>
</div><h3 id="配置文件">配置文件</h3>
<p>和v2ray一樣，位於<code>/etc/v2ray/config.json</code></p>
<h4 id="tcp">TCP</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;poseidon&#34;: {
    &#34;panel&#34;: &#34;v2board&#34;,         
    &#34;nodeId&#34;: 1,                // 你的节点 ID 和 v2board 里的一致
    &#34;checkRate&#34;: 60,            // 每隔多长时间同步一次配置文件、用户、上报服务器信息
    &#34;webapi&#34;: &#34;http or https://YOUR V2BOARD DOMAIN&#34;,// v2board 的域名信息
    &#34;token&#34;: &#34;v2board token&#34;,   // v2board 和 v2ray-poseidon 的通信密钥

    &#34;speedLimit&#34;: 0, // 节点限速 单位 字节/s 0 表示不限速
    &#34;user&#34;: {
      &#34;maxOnlineIPCount&#34;: 0,  // 用户同时在线 IP 数限制 0 表示不限制
      &#34;speedLimit&#34;: 0         // 用户限速 单位 字节/s 0 表示不限速
    },

    &#34;localPort&#34;: 10084 // 本地 api, dokodemo-door,　监听在哪个端口，不能和服务端口相同
  }
}
</code></pre></td></tr></table>
</div>
</div><h4 id="ws--tls">WS + TLS</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;poseidon&#34;: {
    &#34;panel&#34;: &#34;v2board&#34;,         // 这一行必须存在，且不能更改
    &#34;nodeId&#34;: 1,                // 你的节点 ID 和 v2board 里的一致
    &#34;checkRate&#34;: 60,            // 每隔多长时间同步一次配置文件、用户、上报服务器信息
    &#34;webapi&#34;: &#34;http or https://YOUR V2BOARD DOMAIN&#34;,// v2board 的域名信息
    &#34;token&#34;: &#34;v2board token&#34;,   // v2board 和 v2ray-poseidon 的通信密钥

    &#34;speedLimit&#34;: 0, // 节点限速 单位 字节/s 0 表示不限速
    &#34;user&#34;: {
      &#34;maxOnlineIPCount&#34;: 0,  // 用户同时在线 IP 数限制 0 表示不限制
      &#34;speedLimit&#34;: 0         // 用户限速 单位 字节/s 0 表示不限速
    },

    &#34;localPort&#34;: 10084 // 本地 api, dokodemo-door,　监听在哪个端口，不能和服务端口相同
  }
}
</code></pre></td></tr></table>
</div>
</div><h5 id="憑證">憑證</h5>
<p>憑證需要保存在/home/下，命名爲 v2ray.crt v2ray.key</p>
<p>如果用caddy/nginx直接接管ssl部分可以忽略這點</p>
<h3 id="啓動">啓動</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">service v2ray restart
</code></pre></td></tr></table>
</div>
</div><h2 id="docker">Docker</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl -fsSL https://get.docker.com <span class="p">|</span> bash
curl -L <span class="s2">&#34;https://github.com/docker/compose/releases/download/1.25.3/docker-compose-</span><span class="k">$(</span>uname -s<span class="k">)</span><span class="s2">-</span><span class="k">$(</span>uname -m<span class="k">)</span><span class="s2">&#34;</span> -o /usr/local/bin/docker-compose
chmod a+x /usr/local/bin/docker-compose
systemctl start docker
</code></pre></td></tr></table>
</div>
</div><p>可選擇创建个软链接，以后用 dc 命令来代替 docker-compose</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">rm -f `which dc`
# 若系统中存在 dc 则删除，这个 dc 就是个计算器，完全没有用
ln -s /usr/local/bin/docker-compose /usr/bin/dc
</code></pre></td></tr></table>
</div>
</div><h3 id="clone-docker-和配置文件">Clone docker 和配置文件</h3>
<p>默認你有安裝git</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/ColetteContreras/v2ray-poseidon.git
<span class="nb">cd</span> v2ray-poseidon/docker/v2board
</code></pre></td></tr></table>
</div>
</div><h4 id="tcp-模式">TCP 模式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd tcp
# 1. 修改 config.json 中的 poseidon 下面的配置
# 2. 修改 docker-compose.yml 的服务端口
# 启动
dc up -d 
</code></pre></td></tr></table>
</div>
</div><h4 id="cloudflare-cdn--websocket-cdn">CloudFlare CDN + WebSocket CDN</h4>
<ol>
<li>v2board 中节点的连接端口和服务端口都得为 443</li>
<li>CloudFlare 打开代理</li>
<li>修改配置文件并启动 docker</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd ws
# 修改 config.json 中的 poseidon 下面的 nodeId, webapi, 和 token
# 启动
dc up -d
</code></pre></td></tr></table>
</div>
</div><h4 id="websocket-tls-無cdncaddy不接管">WebSocket-TLS 無CDN，Caddy不接管</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd ws-tls
# 1. 修改 config.json 中的 poseidon 下面的配置
# 2. 修改 docker-compose.yml 中的配置，根据你的 DNS 信息
# 启动
dc up -d使

</code></pre></td></tr></table>
</div>
</div><h4 id="websocket-tls-無cdn用caddynginx接管ssl">WebSocket-TLS 無CDN,用Caddy/Nginx接管SSL</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">services:
      v2ray-ws-tls:
        image: v2cc/poseidon
        container_name: v2ray-ws-tls
        restart: always
        ports:
          # 这里服务端口与上文的服务端口一致
          - &#34;服务端口:服务端口&#34;
        volumes:
          - ./config.json:/etc/v2ray/config.json
        environment:
          - USE_CADDY_TLS=false
</code></pre></td></tr></table>
</div>
</div><p>其實與直接WS類似</p>
<h2 id="關於限速">關於限速</h2>
<p>以500b/s爲例</p>
<table>
<thead>
<tr>
<th>單位</th>
<th>數值</th>
</tr>
</thead>
<tbody>
<tr>
<td>位每秒 (bit/s)</td>
<td>4000</td>
</tr>
<tr>
<td>千位每秒 (kbit/s)</td>
<td>4</td>
</tr>
<tr>
<td>兆位每秒 (Mbit/s)</td>
<td>4×10-3</td>
</tr>
<tr>
<td>吉位每秒 (Gbit/s)</td>
<td>4×10-6</td>
</tr>
<tr>
<td>字節每秒 (B/s)</td>
<td>500</td>
</tr>
<tr>
<td>千字節每秒 (kB/s)</td>
<td>0.5</td>
</tr>
<tr>
<td>兆字節每秒 (MB/s)</td>
<td>5x10-4</td>
</tr>
<tr>
<td>吉字節每秒 (GB/s)</td>
<td>5x10-7</td>
</tr>
</tbody>
</table>
<h1 id="備註">備註</h1>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>後端專業版需要付費 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Aapanel</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/aapanel/" />
            <id>https://blog.mrsheep.xyz/posts/aapanel/</id>
            <updated>2020-04-05T12:41:40+08:00</updated>
            <published>2020-04-05T11:54:14+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[aaPanel是寶塔面板的國際版本，我本來是很討厭面板的，安全性不能夠保證。但是必須上就沒辦法了，本文致力於將該面板的安全性進一步增強]]></summary>
            
                <content type="html"><![CDATA[<p>aaPanel是寶塔面板的國際版本，我本來是很討厭面板的，安全性不能夠保證。但是必須上就沒辦法了，本文致力於將該面板的安全性進一步增強</p>
<h1 id="安裝">安裝</h1>
<p>Centos :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">yum install -y wget &amp;&amp; wget -O install.sh http://www.aapanel.com/script/install_6.0_en.sh &amp;&amp; bash install.sh
</code></pre></td></tr></table>
</div>
</div><p>Ubuntu/Deepin :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wget -O install.sh http://www.aapanel.com/script/install-ubuntu_6.0_en.sh &amp;&amp; sudo bash install.sh
</code></pre></td></tr></table>
</div>
</div><p>Debian :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wget -O install.sh http://www.aapanel.com/script/install-ubuntu_6.0_en.sh &amp;&amp; bash install.sh
</code></pre></td></tr></table>
</div>
</div><h1 id="安全改進">安全改進</h1>
<h3 id="ssl">SSL</h3>
<p><strong>開啓之前請綁定域名</strong></p>
<p>開啓ssl之後是無法檢測到Security Entrance的路徑的</p>
<p>寶塔面板的ssl憑證僅僅能夠選擇自簽/Let&rsquo;s encrypt自動獲取，不支持在面板直接指定用戶上傳的憑證。爲了使用自己已經擁有的泛域名憑證，可以直接替換面板憑證</p>
<p>替換<code>/www/server/panel/ssl</code>路徑下的<code>certificate.pem</code>和<code>privateKey.pem</code>爲個人的即可</p>
<h3 id="ip白名單">IP白名單</h3>
<p>擁有固定ip地址建議開啓白名單模式</p>
<h3 id="cdn">CDN</h3>
<p>Cloudflare支持以下非常規端口</p>
<p>HTTP ports supported by Cloudflare:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">- 80
- 8080
- 8880
- 2052
- 2082
- 2086
- 2095
</code></pre></td></tr></table>
</div>
</div><p>HTTPS ports supported by Cloudflare:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">- 443
- 2053
- 2083
- 2087
- 2096
- 8443
</code></pre></td></tr></table>
</div>
</div><p>配置cdn需要在寶塔中新建網站，設置域名爲你的面板域名（PHP純靜態）</p>
<p>反向代理127.0.0.1:端口</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Linux Swap</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/linux-swap/" />
            <id>https://blog.mrsheep.xyz/posts/linux-swap/</id>
            <updated>2020-04-05T11:56:17+08:00</updated>
            <published>2020-04-05T02:17:21+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[有些虛擬伺服器的記憶體給的很少，這個時候就需要虛擬記憶體了]]></summary>
            
                <content type="html"><![CDATA[<p>有些虛擬伺服器的記憶體給的很少，這個時候就需要虛擬記憶體了</p>
<p>創建虛擬記憶體的步驟如下，默認在root下執行</p>
<ul>
<li>
<p>創建Swapfile, 啓用，並更改權限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">dd if=/dev/zero of=/swapfile bs=1M count=你想要的大小
mkswap /swapfile
swapon /swapfile
chmod 600 /swapfile
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>開機啓動,編輯 ``/etc/fstab<code> </code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/swapfile swap swap defaults 0 0
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>關閉虛擬記憶體</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">swapoff -v /swapfile
</code></pre></td></tr></table>
</div>
</div></li>
</ul>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Caddy Ssl</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/caddy-ssl/" />
            <id>https://blog.mrsheep.xyz/posts/caddy-ssl/</id>
            <updated>2020-04-04T19:00:50+08:00</updated>
            <published>2020-04-04T18:41:04+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Cloudflare的Origin CA是CF自簽的憑證，不通過CF的話會報錯。所以就水一篇文章唄。
本文基於Caddy V1.4]]></summary>
            
                <content type="html"><![CDATA[<p>Cloudflare的Origin CA是CF自簽的憑證，不通過CF的話會報錯。所以就水一篇文章唄。</p>
<p>本文基於Caddy V1.4</p>
<h1 id="憑證申請">憑證申請</h1>
<p>Caddy支持自動申請憑證，包括泛域名（需要dns驗證）</p>
<p>單個域名的申請甚至簡單到：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">tls {
	dns cloudflare
}
</code></pre></td></tr></table>
</div>
</div><h3 id="通配符">通配符</h3>
<p>安裝Caddy的時候請添加 <code>tls.dns.你的提供商</code>插件</p>
<p>caddy支持很多的dns provider,具體列表請參見官方Github倉庫：https://github.com/caddyserver/dnsproviders</p>
<p>我使用cloudflare管理域名，即使用cf進行dns challenge。需要配置環境變量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">export CLOUDFLARE_API_KEY=&#34;Cloudflare Global Api&#34;  
export CLOUDFLARE_EMAIL=&#34;Cloudflare 郵箱&#34;
</code></pre></td></tr></table>
</div>
</div><p>其他的dns服務商請參考下表（數據來源：https://caddyserver.com/v1/docs/automatic-https）</p>
<table>
<thead>
<tr>
<th>Provider</th>
<th>Name to Use in Caddyfile</th>
<th>Environment Variables to Set</th>
</tr>
</thead>
<tbody>
<tr>
<td>Aurora DNS by PCExtreme</td>
<td>auroradns</td>
<td>AURORA_USER_ID AURORA_KEY AURORA_ENDPOINT (optional)</td>
</tr>
<tr>
<td>Azure DNS</td>
<td>azure</td>
<td>AZURE_CLIENT_ID AZURE_CLIENT_SECRET AZURE_SUBSCRIPTION_ID AZURE_TENANT_ID</td>
</tr>
<tr>
<td>Cloudflare</td>
<td>cloudflare</td>
<td>CLOUDFLARE_EMAIL CLOUDFLARE_API_KEY</td>
</tr>
<tr>
<td>CloudXNS</td>
<td>cloudxns</td>
<td>CLOUDXNS_API_KEY CLOUDXNS_SECRET_KEY</td>
</tr>
<tr>
<td>DigitalOcean</td>
<td>digitalocean</td>
<td>DO_AUTH_TOKEN</td>
</tr>
<tr>
<td>DNSimple</td>
<td>dnsimple</td>
<td>DNSIMPLE_EMAIL DNSIMPLE_OAUTH_TOKEN</td>
</tr>
<tr>
<td>DNS Made Easy</td>
<td>dnsmadeeasy</td>
<td>DNSMADEEASY_API_KEY DNSMADEEASY_API_SECRET DNSMADEEASY_SANDBOX (true/false)</td>
</tr>
<tr>
<td>DNSPod</td>
<td>dnspod</td>
<td>DNSPOD_API_KEY</td>
</tr>
<tr>
<td>DynDNS</td>
<td>dyn</td>
<td>DYN_CUSTOMER_NAME DYN_USER_NAME DYN_PASSWORD</td>
</tr>
<tr>
<td>Gandi</td>
<td>gandi / gandiv5</td>
<td>GANDI_API_KEY / GANDIV5_API_KEY</td>
</tr>
<tr>
<td>GoDaddy</td>
<td>godaddy</td>
<td>GODADDY_API_KEY GODADDY_API_SECRET</td>
</tr>
<tr>
<td>Google Cloud DNS</td>
<td>googlecloud</td>
<td>GCE_PROJECT GCE_DOMAIN GOOGLE_APPLICATION_CREDENTIALS (or GCE_SERVICE_ACCOUNT_FILE)</td>
</tr>
<tr>
<td>Lightsail by AWS</td>
<td>lightsail</td>
<td>AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY AWS_SESSION_TOKEN (optional) DNS_ZONE (optional)</td>
</tr>
<tr>
<td>Linode</td>
<td>linode</td>
<td>LINODE_API_KEY</td>
</tr>
<tr>
<td>Namecheap</td>
<td>namecheap</td>
<td>NAMECHEAP_API_USER NAMECHEAP_API_KEY</td>
</tr>
<tr>
<td>NS1.</td>
<td>ns1</td>
<td>NS1_API_KEY</td>
</tr>
<tr>
<td>Name.com</td>
<td>namedotcom</td>
<td>NAMECOM_USERNAME NAMECOM_API_TOKEN</td>
</tr>
<tr>
<td>OVH</td>
<td>ovh</td>
<td>OVH_ENDPOINT OVH_APPLICATION_KEY OVH_APPLICATION_SECRET OVH_CONSUMER_KEY</td>
</tr>
<tr>
<td>Open Telekom Cloud Managed DNS</td>
<td>otc</td>
<td>OTC_DOMAIN_NAME OTC_USER_NAME OTC_PASSWORD OTC_PROJECT_NAME OTC_IDENTITY_ENDPOINT (optional)</td>
</tr>
<tr>
<td>PowerDNS</td>
<td>pdns</td>
<td>PDNS_API_URL PDNS_API_KEY</td>
</tr>
<tr>
<td>Rackspace</td>
<td>rackspace</td>
<td>RACKSPACE_USER RACKSPACE_API_KEY</td>
</tr>
<tr>
<td></td>
<td>rfc2136</td>
<td>RFC2136_NAMESERVER RFC2136_TSIG_ALGORITHM RFC2136_TSIG_KEY RFC2136_TSIG_SECRET</td>
</tr>
<tr>
<td>Route53 by AWS</td>
<td>route53</td>
<td>AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY</td>
</tr>
<tr>
<td>Vultr</td>
<td>vultr</td>
<td>VULTR_API_KEY</td>
</tr>
</tbody>
</table>
<p>**申請出的憑證會自動保存在<code>~/.caddy/acme/acme-v02.api.letsencrypt.org/sites/wildcard_.你的域名下**</code></p>
<h1 id="句法">句法</h1>
<p>直接從<a href="https://caddyserver.com/v1/docs/tls">官網文檔</a>抄</p>
<p>需要注意的是Caddy默認最低爲TLS 1.2， 自定義Cipher不支持TLS1.3</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">tls [cert key] {
    ca        uri
    protocols min max
    ciphers   ciphers...
    curves    curves...
    clients   [request|require|verify_if_given] clientcas...
    load      dir
    ask       url
    key_type  type
    dns       provider
    alpn      protos...
    must_staple
    wildcard
}
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>ca</strong> specifies the ACME-compatible Certificate Authority endpoint to request certificates from.</p>
</li>
<li>
<p><strong>cert</strong> and <strong>key</strong> are the same as above.</p>
</li>
<li>
<p><strong>protocols</strong> specifies the minimum and maximum protocol  versions to support. See below for valid values. If min and max are the  same, it need only be specified once.</p>
</li>
<li>
<p><strong>ciphers</strong> is a list of space-separated ciphers that will  be supported, overriding the defaults. If you list any, only the ones  you specify will be allowed and preferred in the order given. See below  for valid values. Customizing cipher suites is not allowed with TLS 1.3.</p>
</li>
<li>
<p><strong>curves</strong> is a list of space-separated curves that will be  supported in the given order, overriding the defaults. Valid curves are  listed below.</p>
</li>
<li>
<p>clients</p>
<p>is a list of space-separated client root CAs used  for verification during TLS client authentication. If used, clients will  be asked to present their certificate by their browser, which will be  verified against this list of client certificate authorities. A client  will not be allowed to connect if their certificate was not signed by  one of these root CAs. Note that this setting applies to the entire  listener, not just a single site. You may modify the strictness of  client authentication using one of the keywords before the list of  client CAs:</p>
<ul>
<li><strong>request</strong> merely asks a client to provide a certificate, but will not fail if none is given or if an invalid one is presented.</li>
<li><strong>require</strong> requires a client certificate, but will not verify it.</li>
<li><strong>verify_if_given</strong> will not fail if none is presented, but reject all that do not pass verification.</li>
<li>The default, if no flag is set but a CA file found, is to do both: to require client certificates and validate them.</li>
</ul>
</li>
<li>
<p><strong>load</strong> is a directory from which to load certificates and  keys. The entire directory and its subfolders will be walked in search  of .pem files. Each .pem file must contain the PEM-encoded certificate  (chain) and key blocks, concatenated together.</p>
</li>
<li>
<p><strong>ask</strong> enables <a href="https://caddyserver.com/v1/docs/automatic-https#on-demand">On-Demand TLS</a>.  On-Demand TLS is NOT recommended if the hostname is given in the  Caddyfile and known at configuration-time. The URL will be queried via  GET and should return a 200 status code if the <code>domain</code> form  value from the query string is allowed to be given a certificate.  Redirects at this endpoint are not followed. The URL should only be  internally accessible. When using this option, Caddy does not enforce  any extra rate limiting; your endpoint is expected to make wise  decisions instead.</p>
</li>
<li>
<p><strong>key_type</strong> is the type of key to use when generating keys  for certificates (only applies to managed or TLS or self-signed  certificates). Valid values are rsa2048, rsa4096, rsa8192, p256, and  p384. Default is currently p256.</p>
</li>
<li>
<p><strong>dns</strong> is the name of a DNS provider; specifying it enables the <a href="https://caddyserver.com/v1/docs/automatic-https#dns-challenge">DNS challenge</a> (see that link for details). Note that you need to give credentials via environment variables for it to work.</p>
</li>
<li>
<p><strong>alpn</strong> is a list of space-separated protocols to use for  Application-Layer Protocol Negotiation (ALPN). For HTTPS servers, HTTP  versions can be enabled/disabled with this setting. Default is <code>h2 http/1.1</code>.</p>
</li>
<li>
<p><strong>must_staple</strong> enables <a href="https://blog.mozilla.org/security/2015/11/23/improving-revocation-ocsp-must-staple-and-short-lived-certificates/">Must-Staple</a> for managed certificates. Use with care.</p>
</li>
<li>
<p><strong>wildcard</strong> will obtain and manage a wildcard certificate for this name by replacing the left-most label with <code>*</code>,  as long as managed TLS with the DNS challenge is enabled. Any sites  which are configured similarly and have the same resulting wildcard name  will then share the same, single certificate. This will not work with  On-Demand TLS because it uses the SNI value for the certificate name. <strong>Note:</strong> Do not use this feature unless you have many subdomains that would otherwise cause you to hit CA rate limits.</p>
</li>
</ul>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">ROS Ipv6</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/ros-ipv6/" />
            <id>https://blog.mrsheep.xyz/posts/ros-ipv6/</id>
            <updated>2020-03-22T19:49:58+08:00</updated>
            <published>2020-03-22T18:53:14+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[h幫朋友升級了1000兆頻寬，順便就幫他上了雙栈，電信的配置真是惱火]]></summary>
            
                <content type="html"><![CDATA[<p>h幫朋友升級了1000兆頻寬，順便就幫他上了雙栈，電信的配置真是惱火</p>
<h1 id="橋接">橋接</h1>
<p>首先需要在光貓裏該成橋接，使用基地臺撥號，具體怎麼修改由很多介紹，我就不再寫了</p>
<p><a href="https://www.yeboyzq.com/luyoujiaohuan/984.html">中国电信天翼光猫改桥接模式方法</a></p>
<p><a href="https://www.v2ex.com/t/468726">中国电信智能网关怎么更改桥接模式拨号啊 | V2EX</a></p>
<h1 id="ipv6">IPv6</h1>
<h2 id="dhcp-client">DHCP Client</h2>
<blockquote>
<p>IPv6 -&gt; DHCPv6 Client -&gt; 新建</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Interface: pppoe out
Request: prefix
Pool name: 隨意
Pool Prefix Length: 60/64/48

✅ Rapid Commit
✅ Add Default Route
</code></pre></td></tr></table>
</div>
</div><h2 id="address-list">Address List</h2>
<blockquote>
<p>IPv6 -&gt; Address -&gt; 新建</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Address: ::/64
From pool: 上一步Pool Name
Interface: bridge
Advertise：✅

如果報錯Duplicated Address Detected勾選
No DAD：✅
</code></pre></td></tr></table>
</div>
</div><h2 id="dhcp-server">DHCP Server</h2>
<blockquote>
<p>IPv6 -&gt; DHCP Address -&gt; 新建</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Name：隨意
Interface：bridge
Address Pool6: 第一步中的名字
Lease Time：小於第一步中的Prefix Expires 
✅ Allow Dual Stack Queue
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Huawei Modern Crack</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/huawei-modern-crack/" />
            <id>https://blog.mrsheep.xyz/posts/huawei-modern-crack/</id>
            <updated>2020-03-22T19:03:00+08:00</updated>
            <published>2020-03-22T02:33:16+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[前幾天朋友升級了中國電信1000兆的頻寬，讓我幫他破解一下。有新玩具爲什麼不呢？幹！]]></summary>
            
                <content type="html"><![CDATA[<p>前幾天朋友升級了中國電信1000兆的頻寬，讓我幫他破解一下。有新玩具爲什麼不呢？幹！</p>
<p>首先，他的光貓還沒有插過光纖，電信也冇上門調試。所以超管的密碼還沒有變，如果已經配置過了的話，建議復位Modern在插光纖前繼續閱讀本文（請記得LOID）</p>
<p>電信小哥上門搞定之後，發現了幾點問題，在註冊完成後會自動覆蓋之前的配置文件，所以還是需要兆電信小哥要到超管密碼</p>
<p>魔改有風險，重灌也有風險，請自己考慮</p>
<h1 id="折騰">折騰</h1>
<ol>
<li>
<p>首先下載解密工具<a href="https://raw.githubusercontent.com/Mr-Sheep/Mr-Sheep.github.io/master/resource/ctce_cfg.exe">ctce_cfg.exe</a></p>
</li>
<li>
<p>登入光貓的後臺<code>192.168.1.1</code>，使用超管賬戶名以及密碼登入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">telecomadmin
nE7jA%5m
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>插入U盤</p>
</li>
<li>
<p>管理&ndash;&gt; 設備管理 &ndash;&gt; 備份配置</p>
</li>
<li>
<p>將U盤目錄下<code>e8_Config_Backup</code>資料夾內的<code>ctce8_HN8145V.cfg</code>拷貝到ctce_cfg.exe目錄下</p>
</li>
<li>
<p>執行<code>./ctce_cfg.exe 1 ctce8_HN8145V.cfg ctce8_HN8145V.xml.gz</code></p>
<p>(我的bash用的wsl，如果是cmd請自行去掉前面<code>./</code>)</p>
</li>
<li>
<p>將上一步得到的<code>ctce8_HN8145V.xml.gz</code>解壓得到<code>ctce8_HN8145V.xml</code></p>
</li>
<li>
<p>編輯該文件，查找關鍵詞<code>telecomadmin</code>，找到一下區塊</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;X_HW_WebUserInfo</span> <span class="na">NumberOfInstances=</span><span class="s">&#34;2&#34;</span><span class="nt">&gt;</span>
<span class="nt">&lt;X_HW_WebUserInfoInstance</span> <span class="na">InstanceID=</span><span class="s">&#34;1&#34;</span> <span class="na">ModifyPasswordFlag=</span><span class="s">&#34;0&#34;</span> <span class="na">UserName=</span><span class="s">&#34;useradmin&#34;</span> <span class="na">Password=</span><span class="s">&#34;$2+GoG!!1.CP7s^&amp;amp;&amp;apos;H()oUk~Ol4NSi8TgTYK9fDjp5$&#34;</span> <span class="na">UserLevel=</span><span class="s">&#34;1&#34;</span> <span class="na">Enable=</span><span class="s">&#34;1&#34;</span> <span class="na">Alias=</span><span class="s">&#34;cpe-1&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;X_HW_WebUserInfoInstance</span> <span class="na">InstanceID=</span><span class="s">&#34;2&#34;</span> <span class="na">ModifyPasswordFlag=</span><span class="s">&#34;1&#34;</span> <span class="na">UserName=</span><span class="s">&#34;telecomadmin&#34;</span> <span class="na">Password=</span><span class="s">&#34;$29wO[/pt}xRd&amp;apos;fdGtk928k6(j/$&amp;lt;vhSm1s4C_tgW6$&#34;</span> <span class="na">UserLevel=</span><span class="s">&#34;0&#34;</span> <span class="na">Enable=</span><span class="s">&#34;1&#34;</span> <span class="na">Alias=</span><span class="s">&#34;cpe-2&#34;</span> <span class="na">PassMode=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/X_HW_WebUserInfo&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>複製粘貼超級管理員的配置到新的一行，我在查閱資料的時候大佬們的xml文件中密碼都是明文，可能是因爲華爲系統要開源了，2019版的8145V的密碼不是明文，在我不知道其算法的情況下，直接複製粘貼了telecomadmin的密文。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;X_HW_WebUserInfo</span> <span class="na">NumberOfInstances=</span><span class="s">&#34;3&#34;</span><span class="nt">&gt;</span>
<span class="nt">&lt;X_HW_WebUserInfoInstance</span> <span class="na">InstanceID=</span><span class="s">&#34;1&#34;</span> <span class="na">ModifyPasswordFlag=</span><span class="s">&#34;0&#34;</span> <span class="na">UserName=</span><span class="s">&#34;useradmin&#34;</span> <span class="na">Password=</span><span class="s">&#34;$2+GoG!!1.CP7s^&amp;amp;&amp;apos;H()oUk~Ol4NSi8TgTYK9fDjp5$&#34;</span> <span class="na">UserLevel=</span><span class="s">&#34;0&#34;</span> <span class="na">Enable=</span><span class="s">&#34;1&#34;</span> <span class="na">Alias=</span><span class="s">&#34;cpe-1&#34;</span> <span class="na">PassMode=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;X_HW_WebUserInfoInstance</span> <span class="na">InstanceID=</span><span class="s">&#34;2&#34;</span> <span class="na">ModifyPasswordFlag=</span><span class="s">&#34;1&#34;</span> <span class="na">UserName=</span><span class="s">&#34;telecomadmin&#34;</span> <span class="na">Password=</span><span class="s">&#34;$29wO[/pt}xRd&amp;apos;fdGtk928k6(j/$&amp;lt;vhSm1s4C_tgW6$&#34;</span> <span class="na">UserLevel=</span><span class="s">&#34;0&#34;</span> <span class="na">Enable=</span><span class="s">&#34;1&#34;</span> <span class="na">Alias=</span><span class="s">&#34;cpe-2&#34;</span> <span class="na">PassMode=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;X_HW_WebUserInfoInstance</span> <span class="na">InstanceID=</span><span class="s">&#34;3&#34;</span> <span class="na">ModifyPasswordFlag=</span><span class="s">&#34;1&#34;</span> <span class="na">UserName=</span><span class="s">&#34;mrsheep&#34;</span> <span class="na">Password=</span><span class="s">&#34;$29wO[/pt}xRd&amp;apos;fdGtk928k6(j/$&amp;lt;vhSm1s4C_tgW6$&#34;</span> <span class="na">UserLevel=</span><span class="s">&#34;0&#34;</span> <span class="na">Enable=</span><span class="s">&#34;1&#34;</span> <span class="na">Alias=</span><span class="s">&#34;cpe-3&#34;</span> <span class="na">PassMode=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
   
<span class="nt">&lt;/X_HW_WebUserInfo&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ul>
<li>
<p><code>NumberOfInstances</code>請修改爲實際變更後的用戶數量</p>
</li>
<li>
<p>新增用戶請變更<code>InstanceID</code></p>
</li>
<li>
<p><code>Alias</code>不想寫可以去掉</p>
</li>
<li>
<p>我修改的時候同時給useradmin進行了提權</p>
</li>
<li>
<p>一些修改</p>
<ul>
<li>
<p><input disabled="" type="checkbox">破除連接限制</p>
<p>搜索<code>TotalTerminalNumbe</code>,將其值變更爲<code>0</code></p>
</li>
<li>
<p><input disabled="" type="checkbox">開啓Telnet功能</p>
<p>搜索<code>TELNETLanEnable</code>，將其值變更爲<code>1</code></p>
</li>
<li>
<p><input disabled="" type="checkbox">禁用自動遠程管理</p>
<p><code>EnableCWMP</code>，將其值變更爲<code>0</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>將修改後的文件gzip壓縮，這裏建議刪除解密時創建的gzip文件和原cfg文件</p>
</li>
<li>
<p><code>ctce_cfg.exe 0 ctce8_HS8145V.xml.gz ctce8_HS8145V.cfg</code>重新加密生成cfg文件</p>
</li>
<li>
<p>將重新生成的文件替換到U盤<code>e8_Config_Backup</code>資料夾內</p>
</li>
<li>
<p>管理&ndash;&gt; 設備管理 &ndash;&gt; ✅快速恢復&ndash;&gt;重啓</p>
</li>
<li>
<p>嘗試登錄</p>
</li>
<li>
<p>網絡&ndash;&gt;遠程管理&ndash;&gt;❎使能週期通知，切斷遠程控制</p>
<p>注意：</p>
<p>這裏的Shell並沒有補全</p>
</li>
</ol>
<h1 id="參考連結">參考連結</h1>
<p><a href="http://www.chinadsl.net/thread-125291-1-1.html">华为光猫新版配置文件加解密工具(适用V3R016C/V2R006C等配置内容头4字节为gfcq的版本)</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Firewalld</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/firewalld/" />
            <id>https://blog.mrsheep.xyz/posts/firewalld/</id>
            <updated>2020-03-22T18:55:02+08:00</updated>
            <published>2020-03-14T18:42:37+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[為了省事，可以直接上Firewalld，而且服務器就只需要開放個端口，firewalld完全夠用（其實就是太懶不想去配置iptables） 這篇文章僅紀錄一下]]></summary>
            
                <content type="html"><![CDATA[<p>為了省事，可以直接上Firewalld，而且服務器就只需要開放個端口，firewalld完全夠用（其實就是太懶不想去配置iptables）
這篇文章僅紀錄一下</p>
<h3 id="安裝">安裝</h3>
<p>CentOS默認即為Firewalld，debian需要額外安裝。
CentOS：
<code>yum install firewalld -y</code>
Debian:
<code> apt -y install firewalld</code></p>
<h3 id="命令">命令</h3>
<ol>
<li>查看開放的端口
<code>firewall-cmd --list-ports</code></li>
<li>開放端口
<code>firewall-cmd --zone=public --add-port=$port/$protocol --permanent</code>
其中：
<ul>
<li><code>--zone</code>：作用域</li>
<li><code>$port</code>：需要開放的端口</li>
<li><code>$protocol</code>：協議</li>
<li><code>--permanent</code>：永久生效</li>
</ul>
</li>
<li>🈲️端口
<code>firewall-cmd --zone=public --remove-port=$port/$protocol --permanent</code>
其中：
<ul>
<li><code>--zone</code>：作用域</li>
<li><code>$port</code>：需要開放的端口</li>
<li><code>$protocol</code>：協議</li>
<li><code>--permanent</code>：永久生效</li>
</ul>
</li>
<li>重載配置
<code>firewall-cmd --reload</code></li>
<li>停止
<code>systemctl stop firewalld</code></li>
<li>開機啟動
<code>systemctl enable firewalld</code></li>
</ol>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">SSH Using PUBKEY</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/ssh-using-pubkey/" />
            <id>https://blog.mrsheep.xyz/posts/ssh-using-pubkey/</id>
            <updated>2020-03-14T21:03:30+08:00</updated>
            <published>2020-03-12T15:37:46+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Secure Shell (SSH) 是一種加密的網絡傳輸協議，可在不安全的網絡中為網絡服務提供安全的傳輸環境
廢話不多，直接開始]]></summary>
            
                <content type="html"><![CDATA[<p>Secure Shell (SSH) 是一種加密的網絡傳輸協議，可在不安全的網絡中為網絡服務提供安全的傳輸環境</p>
<p>廢話不多，直接開始</p>
<h1 id="金鑰生成">金鑰生成</h1>
<h2 id="算法選擇">算法選擇</h2>
<p>建議Switch到<a href="https://ed25519.cr.yp.to/">Ed25519</a></p>
<ul>
<li><strong>🚨 DSA:</strong> 不安全，OpenSSH version 7開始不再支持</li>
<li><strong>⚠️ RSA:</strong> 根據金鑰key size決定，3072和4096 😀. 其他的都需要升級，1024bit的會被認爲是unsafe的</li>
<li><strong>👀 ECDSA:</strong> ECDSA使用的NIST曲線上有一個<a href="https://www.hyperelliptic.org/tanja/vortraege/20130531.pdf">值得關注的問題</a></li>
<li><strong>✅ Ed25519:</strong> 最推薦的生成算法</li>
</ul>
<h2 id="金鑰生成-1">金鑰生成</h2>
<p><code>ssh-keygen -o  -a 100 -t ed25519 -f ~/.ssh/id_ed25519 -C &quot;一些comment&quot;</code></p>
<p>其中:</p>
<ul>
<li>-o: 儲存爲OpenSSH格式（在傳入了-t 參數後可以省略）</li>
<li>-a: KDF（金鑰派生函數）重複的次數，理論上數值越大，暴力破解難度增加，但是會導致驗證速度變慢</li>
<li>-t: 指定金鑰類型，如ed25519</li>
<li>-f: 輸出文件以及位置</li>
<li>-C: 註釋，隨便寫</li>
</ul>
<h2 id="安装公钥">安装公钥</h2>
<p>键入以下命令，在服务器上安装公钥：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">cd .ssh
cat id_rsa.pub &gt;&gt; authorized_keys
</code></pre></td></tr></table>
</div>
</div><p>請修改權限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">chmod 600 authorized_keys
chmod 700 ~/.ssh
</code></pre></td></tr></table>
</div>
</div><p>编辑<code>/etc/ssh/sshd_config</code> 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">RSAAuthentication yes
PubkeyAuthentication yes
</code></pre></td></tr></table>
</div>
</div><p>給予root用戶登錄權限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">PermitRootLogin yes
</code></pre></td></tr></table>
</div>
</div><p>測試完成之後使用
<code>PasswordAuthentication no</code>
完成之後重啓ssh服務
<code>service sshd restart</code></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">MacGateKepper</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/macgatekepper/" />
            <id>https://blog.mrsheep.xyz/posts/macgatekepper/</id>
            <updated>2020-02-27T12:15:33+08:00</updated>
            <published>2020-02-27T12:10:31+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[記錄一下mac提示安裝包損壞或來自未知開發者的解決方法
其實MacOS 從很早之前就引入了一種安全機制：維基百科：Gatekeeper， Apple：About Gatekeeper
解決方法也很簡單：sudo spctl –master-disable]]></summary>
            
                <content type="html"><![CDATA[<p>記錄一下mac提示安裝包損壞或來自未知開發者的解決方法</p>
<p>其實MacOS 從很早之前就引入了一種安全機制：<a href="https://en.wikipedia.org/wiki/Gatekeeper_(macOS)">維基百科：Gatekeeper</a>， <a href="https://support.apple.com/en-us/HT202491">Apple：About Gatekeeper</a></p>
<p>解決方法也很簡單：<code>sudo spctl --master-disable</code></p>
]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Clash/Surge Geoip</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/country.mmdb-fix/" />
            <id>https://blog.mrsheep.xyz/posts/country.mmdb-fix/</id>
            <updated>2020-02-27T12:15:51+08:00</updated>
            <published>2020-02-25T17:13:17+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[今天更新Country.mmdb文件的時候發現需要License Key，看過了Maxmind官方的一份聲明後發現,從2019年12月30日開始，要求用戶註冊Maxmind賬戶獲取免費的金鑰，來下載Geolite 2數據庫。
根據MM的說法，由於GDPR和CCPA的實施，限制了他們基於CC4.0的分享，解決方案就是提供資料的企業和用戶都遵循一定的數據隱私規定。有興趣可以查看官方的聲明]]></summary>
            
                <content type="html"><![CDATA[<p>今天更新Country.mmdb文件的時候發現需要License Key，看過了<a href="https://blog.maxmind.com/2019/12/18/significant-changes-to-accessing-and-using-geolite2-databases/">Maxmind官方的一份聲明</a>後發現,從2019年12月30日開始，要求用戶註冊Maxmind賬戶獲取免費的金鑰，來下載Geolite 2數據庫。</p>
<p>根據MM的說法，由於GDPR和CCPA的實施，限制了他們基於CC4.0的分享，解決方案就是提供資料的企業和用戶都遵循一定的數據隱私規定。有興趣可以查看官方的聲明</p>
<h1 id="解決方法">解決方法</h1>
<ol>
<li>註冊Maxmind帳號：https://www.maxmind.com/en/geolite2/signup，註冊完成之後會發送郵件到郵箱完成初始化設定</li>
<li>Service - My License Key - Generate new license key</li>
<li><a href="https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-Country&amp;license_key=$LICENSEKEY&amp;suffix=tar.gz,">https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-Country&amp;license_key=$LICENSEKEY&amp;suffix=tar.gz,</a>將<code>$LICENSEKEY</code>替換爲上一步獲得的<code>license key</code></li>
</ol>
<h2 id="surge">Surge</h2>
<p>1.添加新的rewrite規則</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">^https:\/\/geolite\.maxmind\.com\/download\/geoip\/database\/GeoLite2-Country\.tar\.gz https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-Country&amp;license_key=$LICENSEKEY&amp;suffix=tar.gz 302
</code></pre></td></tr></table>
</div>
</div><p>將<code>$LICENSEKEY</code>替換爲上一步獲得的<code>license key</code></p>
<p>2.MitM添加新的規則</p>
<p><code>geolite.maxmind.com</code>或者是<code> *.maxmind.com</code></p>
<h2 id="clash">Clash</h2>
<p>Clash Cli版本推薦直接獲取Country.mmdb文件後替現有文件,CFW可以在面板中直接粘貼License Key或者使用如下URL</p>
<p><code>https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-Country&amp;license_key=$LICENSEKEY&amp;suffix=tar.gz</code></p>
<p>將<code>$LICENSEKEY</code>替換爲上一步獲得的<code>license key</code></p>
<h2 id="heading"></h2>
<h1 id="參考">參考</h1>
<p><a href="https://blog.maxmind.com/2019/12/18/significant-changes-to-accessing-and-using-geolite2-databases/">Significant Changes to Accessing and Using GeoLite2 Databases</a></p>
<p><a href="https://merlinblog.xyz/wiki/geoip.html">关于GeoIP的二三事|Clash/Surge如何更新GeoIP库</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Simple Torrent</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/simple-torrent/" />
            <id>https://blog.mrsheep.xyz/posts/simple-torrent/</id>
            <updated>2020-02-22T15:50:38+08:00</updated>
            <published>2020-02-22T15:25:34+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Simple-Torrent基於Cloud-Torrent修改而來，鑑於Cloud-Torrent作者已经不再维护，同時Simple-Torrent添加了很多必要的新Features。個人感覺相比較之下，Simple torrent會非常的方便]]></summary>
            
                <content type="html"><![CDATA[<p><a href="https://github.com/boypt/simple-torrent">Simple-Torrent</a>基於<a href="https://github.com/jpillora/cloud-torrent">Cloud-Torrent</a>修改而來，鑑於Cloud-Torrent作者已经不再维护，同時Simple-Torrent添加了很多必要的新Features。個人感覺相比較之下，Simple torrent會非常的方便</p>
<h1 id="new-features">New-Features</h1>
<p><strong>摘自<a href="https://github.com/boypt/simple-torrent">boypt/simple-torrent</a></strong></p>
<ul>
<li>Individual file download control (1.1.3+)</li>
<li>Run extrenal program on tasks completed: <code>DoneCmd</code></li>
<li>Stops task when seeding ratio reached: <code>SeedRatio</code></li>
<li>Download/Upload speed limiter: <code>UploadRate</code>/<code>DownloadRate</code></li>
<li>Detailed transfer stats in web UI.</li>
<li><a href="https://github.com/boypt/simple-torrent/wiki/Torrent-Watcher">Torrent Watcher</a></li>
<li>K8s/docker health-check endpoint <code>/healthz</code></li>
<li>Extra trackers from extrenal source</li>
<li>Protocol Handler to <code>magnet:</code></li>
<li>Magnet RSS subscribing supported</li>
<li>Flexible config file accepts multiple formats (.json/.yaml/.toml) (<a href="https://github.com/spf13/viper/">by spf13/Viper</a>) (1.2.0+)</li>
</ul>
<p>Also:</p>
<ul>
<li>Single binary</li>
<li>Cross platform</li>
<li>Embedded torrent search</li>
<li>Real-time updates</li>
<li>Mobile-friendly</li>
<li>Fast <a href="http://golang.org/pkg/net/http/#ServeContent">content server</a></li>
<li>IPv6 out of the box</li>
<li>Updated torrnet engine from <a href="https://github.com/anacrolix/torrent">anacrolix/torrent</a></li>
</ul>
<h1 id="安装">安装</h1>
<h3 id="一鍵安裝指令">一鍵安裝指令：</h3>
<p><code> bash &lt;(wget -qO- https://raw.githubusercontent.com/boypt/simple-torrent/master/scripts/quickinstall.sh)</code></p>
<p>这个命令会完成如下：</p>
<pre><code>1. 下载Simple-torrent bin
2. 创建自动启动文件/etc/systemd/system/cloud-torrent.service
3. 创建配置文件cloud-torrent.json
</code></pre>
<p>完成之后默认端口为<code>3000</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">systemctl start cloud-torrent
systemctl restart cloud-torrent
systemctl stop cloud-torrent
systemctl status cloud-torrent
</code></pre></td></tr></table>
</div>
</div><h3 id="一些建議配置">一些建議配置：</h3>
<h4 id="tls">TLS</h4>
<p>個人會建議開啓https支持，畢竟你不希望下載部分資源的時候使用明文傳輸</p>
<p>可以自簽一張憑證，如下命令一鍵生成即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">openssl req -x509 -nodes -sha256 -newkey \ rsa:2048 -keyout server.key -out server.crt \ -config openssl.cnf -extensions v3_req
</code></pre></td></tr></table>
</div>
</div><p>之後請編輯<code>/etc/systemd/system/cloud-torrent.service</code></p>
<p>在啓動參數<code>ExecStart</code>中加上   &ndash;key-path /金鑰位置 &ndash;cert-path /證書位置,並更改端口爲443</p>
<h4 id="tracker">Tracker</h4>
<p>推薦<a href="https://github.com/ngosang/trackerslist">ngosang/trackerslist</a>,所有的Tracker均爲每日更新</p>
<ul>
<li>trackers_best (20 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_best.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt">mirror</a></li>
<li>trackers_all (82 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_all.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all.txt">mirror</a></li>
<li>trackers_all_udp (48 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_all_udp.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all_udp.txt">mirror</a></li>
<li>trackers_all_http (30 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_all_http.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all_http.txt">mirror</a></li>
<li>trackers_all_https (4 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_all_https.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all_https.txt">mirror</a></li>
<li>trackers_all_ws (3 trackers) =&gt; <a href="https://ngosang.github.io/trackerslist/trackers_all_ws.txt">link</a> / <a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all_ws.txt">mirror</a></li>
</ul>
<h1 id="最後">最後</h1>
<p>API 、遠程調用的我就不去嘗試了，由於涉及DCMA，伺服器位置偏僻，線路質量堪憂</p>
<p>Simple Torrent對於我來說最主要的就是下載4k電影之後回傳到本地</p>
<p>好啦，其實這個也是一篇水文，最近沒有什麼可以更新的內容</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CF iPv6</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/cf-ipv6/" />
            <id>https://blog.mrsheep.xyz/posts/cf-ipv6/</id>
            <updated>2019-12-04T14:45:38+08:00</updated>
            <published>2019-12-04T14:38:39+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Cloudflare早在2011年就啓動了<strong>Automatic IPv6 Gateway</strong>這個項目，解決v4和v6不兼容的問題。
Cloudflare可以自動化的完成v4和v6的tunnel
開啓方法也十分的簡單，在Cloudflare管理頁面找到Network下的ipv6，enable即可]]></summary>
            
                <content type="html"><![CDATA[<p>Cloudflare早在2011年就啓動了**<a href="https://blog.cloudflare.com/introducing-cloudflares-automatic-ipv6-gatewa/">Automatic IPv6 Gateway</a>**這個項目，解決v4和v6不兼容的問題。</p>
<p>Cloudflare可以自動化的完成v4和v6的tunnel</p>
<p>開啓方法也十分的簡單，在Cloudflare管理頁面找到<strong>Network</strong>下的ipv6，<strong>enable</strong>即可</p>
<p><img src="https://blog.cloudflare.com/content/images/cloudflare-ipv6-infographic.png.scaled500.png" alt="CF-auto-ipv6-gw"></p>
<p>恭喜你點進來了，其實這是水文</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Vmware Credential Guards Fix</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/vmware-credential-guards-fix/" />
            <id>https://blog.mrsheep.xyz/posts/vmware-credential-guards-fix/</id>
            <updated>2019-12-01T19:35:41+08:00</updated>
            <published>2019-12-01T19:31:35+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Just can’t open my vm]]></summary>
            
                <content type="html"><![CDATA[<p>Just can&rsquo;t open my vm</p>
<h1 id="disable-hyper-v">Disable Hyper-V</h1>
<p>Fireup a powershell as administrator, type in following commands</p>
<p><code>bcdedit /set hypervisorlaunchtype off</code></p>
<p>Then reboot</p>
<h1 id="device-guard">Device guard</h1>
<h3 id="disable-device-guard"><strong>Disable Device Guard</strong></h3>
<p>Editing the Registry with following key:  <strong>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity</strong></p>
<p>Set:  Name = “<strong>Enabled”</strong>  Type =dword  Data = <strong>0</strong></p>
<p>Then reboot</p>
<p>Also, you can start <strong>gpedit.msc</strong></p>
<p>Under <strong>Computer Configuration\Administrative Templates\System\Device Guard</strong>, change it to  <strong>disabled</strong>.</p>
<p><strong>If you see the same settings as below, you might not have Device Guard enabled.</strong></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">DoT vs DoH</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/dot-vs-doh/" />
            <id>https://blog.mrsheep.xyz/posts/dot-vs-doh/</id>
            <updated>2019-11-28T16:02:38+08:00</updated>
            <published>2019-11-28T14:54:10+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[DoH （RFC 8484）和 DoT（RFC 7858）以及先前的DNSCrypt和DNSSEC都是進行安全化的域名解析的方案，Mozilla從Firefox 62開始支持DoH（官方博文）
DoH是最新的方案，衆多大佬都開始支持了，就假裝不是草案了唄，其實人家只是Proposed Standard
這篇文章是想廢話一下這些方案的區別]]></summary>
            
                <content type="html"><![CDATA[<p>DoH （<a href="https://datatracker.ietf.org/doc/rfc8484/">RFC 8484</a>）和 DoT（<a href="https://tools.ietf.org/html/rfc7858">RFC 7858</a>）以及先前的DNSCrypt和DNSSEC都是進行安全化的域名解析的方案，Mozilla從Firefox 62開始支持DoH（<a href="https://blog.nightly.mozilla.org/2018/06/01/improving-dns-privacy-in-firefox/">官方博文</a>）</p>
<p><a href="https://datatracker.ietf.org/doc/rfc8484/">DoH</a>是最新的方案，衆多大佬都開始支持了，<del>就假裝不是草案了唄，其實人家只是Proposed Standard</del></p>
<p>這篇文章是想廢話一下這些方案的區別</p>
<h1 id="普通的dns">普通的DNS</h1>
<p>最初的DNS (Domain Name System)協議於1987年定稿，但是那個時候的Internet基本不需要考慮安全問題（<del>能不能夠跑起來都是問題</del>）所以最初的DNS協議是直接明文的。按照<a href="https://www.cloudflare.com/learning/ddos/glossary/domain-name-system-dns/">CloudFlare</a>的話來說，DNS可以被理解爲“互聯網的電話黃頁（phonebook of the internet）”,下圖來自CloudFlare</p>
<p><img src="https://github.com/Mr-Sheep/Mr-Sheep.github.io/raw/master/resource/img/ddos-dns-request.webp" alt="ddos-dns-request"></p>
<p>但是明文傳輸的設計在現在看來有很多的不足，這也就是爲什麼GFW可以清楚的知道你訪問了甚麼網站，因爲你查詢的域名是明文傳輸的，同時還可以對你的DNS查詢進行投毒，篡改結果。以GFW爲例，會將黑名單內的網址解析到Facebook等公司的ip上去。比如說我的域名 mrsheep.xyz。</p>
<p>鑑於以上這些情況，更加安全的DNS查詢與傳輸顯得非常重要，於是在2011年的時候，全球的根服務器以及大多數的頂級域名都部署了<a href="https://tools.ietf.org/html/rfc4035">DNSSEC</a></p>
<h2 id="dnssec">DNSSEC</h2>
<p>上面說道的<a href="https://tools.ietf.org/html/rfc4035">DNSSEC</a>僅僅在最初的DNS協議上加入了數字簽名，以此校驗查詢結果的合法性（不是正確性），也就是說，GFW還是可以達到DNS污染的目的</p>
<h2 id="dnscrypt">DNSCrypt</h2>
<p>官網在這裏:<a href="https://dnscrypt.info">DNSCrypt</a></p>
<p>原理：<a href="https://dnscrypt.info/protocol/">DNSCrypt/Protocol</a></p>
<p>維基詞條：<a href="https://zh.wikipedia.org/wiki/DNSCrypt">DNSCrypt</a></p>
<p>簡單來說DNSCrypt會對你的DNS查詢進行加密以及數字簽名驗證，但是DNS的到達時間可以被識別</p>
<p>openDNS和Quad 9均有部署該協議</p>
<h1 id="dns-over-tls">DNS over TLS</h1>
<p>建立於TLS之上的DNS查詢，使用端口<code>853</code>，因爲使用TLS的原因，TLS採用CA認證，所以DoT同時具備“合法性”和”真實性“。</p>
<p>由於DNS是建立於TLS之上的，這代表着DoT會混在一堆tls連接中，無法被提出來特別針對</p>
<p>同時，大多數的瀏覽器並不支持DoT，可以使用Overture等軟件實現。</p>
<h1 id="dns-over-https">DNS over HTTPS</h1>
<p>最新的協議，<a href="https://datatracker.ietf.org/doc/rfc8484/">RFC 8484</a>，簡單的來說就是在DoT上套了一層http協議，可以理解爲DNS-over-HTTP-over-TLS，以此達到僞裝的效果，從而繞過運營商的重定向代理，實現方式其實蠻丑的。。。</p>
<p>由於中華人民共和國網絡出口常年故障，導致使用境外的DoH服務商會大幅增加解析時間</p>
<p>從本質上來講和DoT沒什麼區別，但是相對於DoT來說有更多的大佬支持，比如Mozilla，下圖基本說明了DoH的作用，圖自Mozilla</p>
<p><img src="https://github.com/Mr-Sheep/Mr-Sheep.github.io/raw/master/resource/img/DoH.png" alt="DoH"></p>
<h1 id="參考文章">參考文章</h1>
<p>[<a href="https://program-think.blogspot.com/2018/10/Comparison-of-DNS-Protocols.html">对比4种强化域名安全的协议——DNSSEC，DNSCrypt，DNS over TLS，DNS over HTTPS</a>]</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Java Split Digit</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/java-split-digit/" />
            <id>https://blog.mrsheep.xyz/posts/java-split-digit/</id>
            <updated>2020-04-23T19:49:14+08:00</updated>
            <published>2019-11-28T09:22:17+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[這是水文😂
真的是一篇水文
主要是我想不到要寫甚麼了]]></summary>
            
                <content type="html"><![CDATA[<p>這是水文😂</p>
<p>真的是一篇水文</p>
<p>主要是我想不到要寫甚麼了</p>
<h1 id="heading">😀</h1>
<p>主要是AMC10有一道題，1000到2013中，多少數字前三位（千，百，十）相加之和爲個位數</p>
<p>然後。。。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tester</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">1000</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">2014</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">num</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
			<span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
			<span class="k">while</span> <span class="o">(</span><span class="n">number</span> <span class="o">!=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">num</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">number</span> <span class="o">%</span> <span class="n">10</span><span class="o">);</span>
				<span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">/</span> <span class="n">10</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">if</span> <span class="o">((</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">3</span><span class="o">)+</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">2</span><span class="o">)+</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">1</span><span class="o">))==</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">))</span> <span class="o">{</span>
					<span class="n">count</span> <span class="o">++;</span>
					<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">count</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Powered By HUGO</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/hugo/" />
            <id>https://blog.mrsheep.xyz/posts/hugo/</id>
            <updated>2020-04-23T19:52:25+08:00</updated>
            <published>2019-11-27T12:58:53+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[博客正式遷移到了Hugo上，Hugo是使用GO語言開發的SSG（靜態網站生成器），官方稱“The world’s fastest framework for building websites”. 不同於Hexo的是，Hugo是一個網站的框架，爾Hexo僅僅是博客的框架。
“Let’s Encrypt”， “1Password Support”，“CloudFlare Developer”等均是用Hugo開放
更多的實例可以參考官方Showcase]]></summary>
            
                <content type="html"><![CDATA[<p>博客正式遷移到了Hugo上，<a href="https://gohugo.io/">Hugo</a>是使用GO語言開發的SSG（靜態網站生成器），官方稱“The world’s fastest framework for building websites”. 不同於Hexo的是，Hugo是一個網站的框架，爾Hexo僅僅是博客的框架。</p>
<p>“Let&rsquo;s Encrypt”， “1Password Support”，“CloudFlare Developer”等均是用Hugo開放</p>
<p>更多的實例可以參考<a href="https://gohugo.io/showcase/">官方Showcase</a></p>
<h1 id="文件結構">文件結構</h1>
<p>文件結構相比較於Hexo簡潔了不少，主題採用submodule的方式安裝即可，免去了之前Hexo下主題.git文件夾需要刪除的問題。以我用的MemE主題爲例，樹狀圖如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-basic" data-lang="basic"><span class="vg">tree</span>
<span class="vg">Folder</span><span class="w"> </span><span class="vg">PATH</span><span class="w"> </span><span class="vg">listing</span>
<span class="vg">Volume</span><span class="w"> </span><span class="vg">serial</span><span class="w"> </span><span class="vg">number</span><span class="w"> </span><span class="vg">is</span><span class="w"> 
</span><span class="w"></span><span class="nl">C:</span><span class="o">.</span>
<span class="err">├───</span><span class="vg">archetypes</span>
<span class="err">├───</span><span class="vg">content</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">about</span>
<span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">posts</span>
<span class="err">├───</span><span class="vg">data</span>
<span class="err">├───</span><span class="vg">layouts</span>
<span class="err">├───</span><span class="vg">public</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">about</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">categories</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">css</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">fonts</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">icons</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">js</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">page</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="il">1</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="il">2</span>
<span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">posts</span>
<span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">tags</span>
<span class="err">├───</span><span class="vg">resources</span>
<span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">_gen</span>
<span class="err">│</span><span class="w">       </span><span class="err">├───</span><span class="vg">assets</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">scss</span>
<span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">       </span><span class="err">└───</span><span class="vg">scss</span>
<span class="err">│</span><span class="w">       </span><span class="err">└───</span><span class="vg">images</span>
<span class="err">├───</span><span class="vg">static</span>
<span class="err">└───</span><span class="vg">themes</span>
<span class="w">    </span><span class="err">├───</span><span class="vg">hugo</span><span class="o">-</span><span class="vg">notice</span>
<span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">i18n</span>
<span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">layouts</span>
<span class="w">    </span><span class="err">│</span><span class="w">       </span><span class="err">└───</span><span class="vg">shortcodes</span>
<span class="w">    </span><span class="err">└───</span><span class="vg">meme</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">assets</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">js</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">scss</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">├───</span><span class="vg">_common</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">_highlight</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">_page</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">├───</span><span class="vg">_custom</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">└───</span><span class="vg">_variables</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">config</span><span class="o">-</span><span class="vg">examples</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">en</span><span class="o">-</span><span class="vg">us</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">zh</span><span class="o">-</span><span class="vg">cn</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">data</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">exampleSite</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">resources</span>
<span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="err">└───</span><span class="vg">_gen</span>
<span class="w">        </span><span class="err">│</span><span class="w">           </span><span class="err">└───</span><span class="vg">assets</span>
<span class="w">        </span><span class="err">│</span><span class="w">               </span><span class="err">└───</span><span class="vg">scss</span>
<span class="w">        </span><span class="err">│</span><span class="w">                   </span><span class="err">└───</span><span class="vg">scss</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">i18n</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">images</span>
<span class="w">        </span><span class="err">├───</span><span class="vg">layouts</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">partials</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">components</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">third</span><span class="o">-</span><span class="vg">party</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">tree</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">section</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">├───</span><span class="vg">taxonomy</span>
<span class="w">        </span><span class="err">│</span><span class="w">   </span><span class="err">└───</span><span class="vg">_default</span>
<span class="w">        </span><span class="err">└───</span><span class="vg">static</span>
<span class="w">            </span><span class="err">├───</span><span class="vg">fonts</span>
<span class="w">            </span><span class="err">└───</span><span class="vg">icons</span>
</code></pre></td></tr></table>
</div>
</div><p>如果精簡一下的話就是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">├───archetypes                                                                     ├───content                                                                       
├───data                                                                           ├───layouts                                                                       
├───public
├───resources
├───static
└───themes
</code></pre></td></tr></table>
</div>
</div><h2 id="遷移">遷移</h2>
<p>其實，因爲遷移的時候我的筆電正在維修，所以我是複製粘貼的。。。</p>
<h2 id="meme">MemE</h2>
<p><strong>MemE</strong>是一個十分簡潔但是十分強大的Hugo主題，由<a href="https://io-oi.me/tech/documentation-of-hugo-theme-meme/" title="Hugo 主题 MemE 文档">reuixiy | 一休爾</a>開發，爲個人博客設計.</p>
<p>正如作者寫到“MemE主題對於習慣了Hexo的用戶非常友好，是從Hexo錢一道Hugo的不錯選擇”，MemE的配置十分的方便</p>
<h3 id="一些修改">一些修改</h3>
<h4 id="字體">字體</h4>
<p>支持調用Google Font這類的字體，只需要更改主題文件中的<code>Font Family</code>部分即可。如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="c">## Font Family</span>

    <span class="c"># Note: any option is empty(&#34;&#34;),</span>
    <span class="c">#       fallback to `fontFamilyBody`</span>
    <span class="c">#       it will. Therefore, it is not</span>
    <span class="c">#       necessary to set all.</span>
    <span class="c">#       Additionally, you can leave</span>
    <span class="c">#       `fontFamilySiteBrand` empty(&#34;&#34;)</span>
    <span class="c">#       if you use SVG as your site</span>
    <span class="c">#       brand.</span>

    <span class="c"># Site brand</span>
    <span class="nx">fontFamilySiteBrand</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Menu bar</span>
    <span class="nx">fontFamilyMenu</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Post title, post subtitle, list title, year and month title of the list, related posts title, previous/next post title</span>
    <span class="nx">fontFamilyTitle</span> <span class="p">=</span> <span class="s2">&#34;Kalam, sans-serif&#34;</span>
    <span class="c"># Headings, toc title</span>
    <span class="nx">fontFamilyHeadings</span> <span class="p">=</span> <span class="s2">&#34;Noto Serif TC, serif&#34;</span>
    <span class="c"># Code, superscript, post meta info, post updated badge, post gitinfo, minimal footer</span>
    <span class="nx">fontFamilyCode</span> <span class="p">=</span> <span class="s2">&#34;&#39;Source Code Pro&#39;, monospace&#34;</span>
    <span class="c"># Blockquotes</span>
    <span class="nx">fontFamilyQuote</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Table of contents</span>
    <span class="nx">fontFamilyTOC</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Caption</span>
    <span class="nx">fontFamilyCaption</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Footer</span>
    <span class="nx">fontFamilyFooter</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c"># Body</span>
    <span class="c"># Text font</span>
    <span class="nx">fontFamilyBody</span> <span class="p">=</span> <span class="s2">&#34;&#39;Noto Serif TC&#39;, serif&#34;</span>

    <span class="c"># Embed fonts link</span>

    <span class="nx">fontsLink</span> <span class="p">=</span> <span class="s2">&#34;https://fonts.googleapis.com/css?family=Noto+Serif+TC:600,700|Source+Code+Pro:400,400i,700,700i|ZCOOL+XiaoWei|Kalam:700&amp;display=swap&#34;</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="更新">更新</h3>
<p>Hugo採用Submodule進行主題的更新</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git submodule update --rebase --remote
</code></pre></td></tr></table>
</div>
</div><p>如果提示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">error: cannot rebase: You have unstaged changes.
error: Please commit or stash them.
Unable to rebase <span class="s1">&#39;2f57a2c629c7c1bd5f7fd6cf3640db0d449b52d9&#39;</span> in submodule path <span class="s1">&#39;themes/meme&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>就按照提示先 <code>git stash</code>,在rebase之後執行<code>git stash pop</code>即可</p>
<p>待更</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Surge 3 CFG</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/surge-3-cfg/" />
            <id>https://blog.mrsheep.xyz/posts/surge-3-cfg/</id>
            <updated>2020-04-23T19:49:15+08:00</updated>
            <published>2019-11-27T09:35:37+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[11-30-2019 更新：Surge as Gateway
Surge是一個功能十分強大的網絡工具箱，可以作為高性能的HTTP和SOCKS代理服務器。可以完成抓包，分析等工作， 支持規則代理，支持多種代理（支持V2Ray）。並包括基於TLS的HTTP(s), Socks5等]]></summary>
            
                <content type="html"><![CDATA[<p>11-30-2019 更新：Surge as Gateway</p>
<p>Surge是一個功能十分強大的網絡工具箱，可以作為高性能的HTTP和SOCKS代理服務器。可以完成抓包，分析等工作，
支持規則代理，支持多種代理（支持V2Ray）。並包括基於TLS的HTTP(s), Socks5等</p>
<h1 id="為甚麼使用surge">為甚麼使用Surge</h1>
<p>我知道有一大把開源項目，比如做的非常好的Clash，並且有MacOS的Dashboard，但是由於目前仍出於Pre-Release階段，部分功能並不完善和穩定
相比較下，Surge作為一個付費軟件，客服支持做的更好（交了錢當然好）
但是更重要的，是Surge作為網關使用會比Clash更加的強大，用戶界面看著更加的完善，有完整的User Manual,支持MitM和抓包等
算了我編不下去了，反正好用就行了
關於購買這一塊兒，別去找盜版了，找不到的</p>
<h2 id="無限試用">無限試用</h2>
<p>通過更改系統時間的方法可以獲得無限的使用，但是這樣做會無法啟動Dashboard,不清楚是不是因為試用版的原因</p>
<p>另，別想着去找盜版了~~（別問我怎麼知道的）~~</p>
<h1 id="配置">配置</h1>
<p>基本的配置教程官方寫的十分的詳細，可以直接參考<a href="https://manual.nssurge.com/">nssurge manual</a>
我只寫一些，畢竟人家大佬寫了那麼多</p>
<h2 id="dns">DNS</h2>
<p>Surge支持DoH，使用方法為直接在<code>DNS</code>配置中添加，或者是直接修改配置文件
在頭部 <code>[General]</code> 部分添加:
<code>dns-server = 你指定的dns服務器</code>,
但是支持DoH的大多在CN沒有服務器，延遲比較高，但是解決了DNS投毒的問題,一下列部分支持DoH的服務商</p>
<ol>
<li><a href="https://cloudflare-dns.com/dns-query">https://cloudflare-dns.com/dns-query</a></li>
<li>https://1.1.1.1/dns-query //1.1.1.1這個地址很可能會被作為保留地址，比如說某為</li>
<li><a href="https://dns.google.com/resolve">https://dns.google.com/resolve</a></li>
<li>https://8.8.8.8/dns-query</li>
<li><a href="https://dns.quad9.net/dns-query">https://dns.quad9.net/dns-query</a></li>
<li>https://9.9.9.9/dns-query</li>
<li><a href="https://dns.rubyfish.cn/dns-query">https://dns.rubyfish.cn/dns-query</a></li>
</ol>
<p>Surge Enhanced mode採用Fakeip模式，雖然算是解決了污染的問題，但是如果Surge目前並沒有實現DNS“分流”這項功能，個人覺得可以配合外置DNS來解決問題
<strong>Overture</strong> 可以很好的解決這個問題，Overture僅支持DoT（DNS over TLS）,關於DoH和DoT，可以參考<a href="https://www.reddit.com/r/privacy/comments/89pr15/dnsoverhttps_vs_dns_overtls_vs_dnscrypt/">Reddit上的帖子</a>
關於DoT和DoH誰更好已經爭論了很久了
關於Overture如何配置，請參見另一篇文章</p>
<h2 id="v2ray">V2Ray</h2>
<p>Surge從3.3.1版本（應該是）開始支持原生V2Ray，不再需要External-Proxy或者是前置代理實現
格式如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">你的代理名字</span> <span class="o">=</span> vmess, 服務器地址, 端口, <span class="nv">username</span><span class="o">=</span>uuid, <span class="nv">tls13</span><span class="o">=</span>true, <span class="nv">ws</span><span class="o">=</span>true, ws-path<span class="o">=</span>路徑
</code></pre></td></tr></table>
</div>
</div><p>注：</p>
<ol>
<li><code>tls13 = true</code> 即強制使用tls1.3，使用前請<strong>確認支持</strong>，如果<strong>不支持</strong>,請將該命令改成<code>tls = true</code>來啟動tls</li>
<li>如果你不需要驗證證書，可以把證書添加進入mac的<strong>鑰匙串</strong>,或者你自己研究怎麼跳過驗證</li>
<li><code>ws-header</code>如果有需要，可以單獨設置，具體請參見官方<a href="https://community.nssurge.com/">Community</a></li>
</ol>
<h1 id="gateway">Gateway</h1>
<p>將Surge作爲本地網關對於我個人來說比使用<a href="https://blog.mrsheep.xyz/posts/clash-gateway/">Clash作爲網關</a>好用的多，Clash封裝的軟件總是有神神奇奇的問題。Surge採用 Fake-ip 方案，即對於所有dns查詢都返回198.18.x.x的ip。</p>
<h3 id="甚麼是網關">甚麼是網關</h3>
<p>可以參考<a href="https://zh.wikipedia.org/zh-hant/%E7%BD%91%E5%85%B3">維基百科</a>的詞條</p>
<p>簡單的來說需要實現網絡之間的通信，就必須要通過網關。</p>
<h3 id="配置-1">配置</h3>
<h4 id="surge">Surge</h4>
<p>Surge的配置十分的簡單，只需要打開<code>Enhanced mode</code>即可，同時請注意，你的mac的網關地址需要手動設定爲上級路由地址。</p>
<p>並且需要在surge中指定dns地址</p>
<p>根據<a href="https://medium.com/@Blankwonder/surge-mac-as-gateway-b0bd68464a4b">Surge作者的說法</a>，“macOS 10.13 后完善了 Kernel 的转发机制”</p>
<p>使用Surge作爲網關的優勢由很多，比如</p>
<ol>
<li>支持tcp和udp代理</li>
<li>搞定類似於Google Home這樣不支持手動配置代理的設備</li>
<li>Hands-Freed的全局代理</li>
<li>Apple TV使用代理會有莫名其妙的Bug</li>
</ol>
<h4 id="客戶端">客戶端</h4>
<p>在網絡設置中將網關地址改成<code>mac ip</code>，dns改成<code>198.18.0.2</code>或者其他</p>
<h4 id="路由器">路由器</h4>
<p>同上，僅需要在配置中將網關地址和dns更改即可。</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Overture 配置</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/overture-cfg/" />
            <id>https://blog.mrsheep.xyz/posts/overture-cfg/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-11-16T17:04:11+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[Overture是一個由GO編寫的DNS，跨平台兼容，能夠很好的實現我分流的需求，相比与CoreDNS无论如何我都編譯不成功的proxy插件，實在是便捷了很多]]></summary>
            
                <content type="html"><![CDATA[<p>Overture是一個由GO編寫的DNS，跨平台兼容，能夠很好的實現我分流的需求，相比与CoreDNS无论如何我都編譯不成功的proxy插件，實在是便捷了很多</p>
<h2 id="features">Features</h2>
<p>摘自<a href="https://github.com/shawn1m/overture">github.com/shawn1m/overture</a></p>
<ul>
<li>Full IPv6 support</li>
<li>Multiple DNS upstream
<ul>
<li>Via UDP/TCP with custom port</li>
<li>Via SOCKS5 proxy (TCP only)</li>
<li>With EDNS Client Subnet (ECS) <a href="https://tools.ietf.org/html/rfc7871">RFC7871</a></li>
</ul>
</li>
<li>Dispatcher
<ul>
<li>IPv6 record (AAAA) redirection</li>
<li>Custom domain</li>
<li>Custom IP network</li>
</ul>
</li>
<li>Minimum TTL modification</li>
<li>Hosts (Random order if there are multiple answers)</li>
<li>Cache with ECS</li>
</ul>
<h2 id="配置">配置</h2>
<p>從<a href="https://github.com/shawn1m/overture/releases">Release</a>裡下載prebuilt版，並解壓</p>
<p>下載GFW和CN_ip列表,放置於同一目錄</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">wget https://cokebar.github.io/gfwlist2dnsmasq/gfwlist_domain.txt <span class="o">&amp;&amp;</span> wget https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt
</code></pre></td></tr></table>
</div>
</div><p>之後就可以魔改配置文件了</p>
<p><code> vim config.json</code></p>
<p>我的配置文件如下,國內走DNSPod，114，AliDNS；國外走CF，Google，OpenDNS</p>
<p>支持EDNS的我開了auto，國外的走DoT</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="s2">&#34;BindAddress&#34;</span><span class="err">:</span> <span class="s2">&#34;:53&#34;</span><span class="err">,</span> <span class="err">//監聽地址</span>
  <span class="s2">&#34;DebugHTTPAddress&#34;</span><span class="err">:</span> <span class="s2">&#34;127.0.0.1:5555&#34;</span><span class="err">,</span>
  <span class="s2">&#34;PrimaryDNS&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;DNSPod&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;119.29.29.29:53&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;114&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;114.114.114.114&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;RubyFish&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;dns.rubyfish.cn:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;AliDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;223.5.5.5:53&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;AlternativeDNS&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;CloudFlareDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;one.one.one.one:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;GoogleDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;dns.google:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;OpenDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;208.67.222.222:443&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;OnlyPrimaryDNS&#34;</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span>
  <span class="s2">&#34;IPv6UseAlternativeDNS&#34;</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span>
  <span class="s2">&#34;WhenPrimaryDNSAnswerNoneUse&#34;</span><span class="err">:</span> <span class="s2">&#34;PrimaryDNS&#34;</span><span class="err">,</span>
  <span class="s2">&#34;IPNetworkFile&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;Primary&#34;</span><span class="p">:</span> <span class="s2">&#34;./china_ip_list.txt&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Alternative&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;DomainFile&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;Primary&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Alternative&#34;</span><span class="p">:</span> <span class="s2">&#34;./gfwlist_domain.txt&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Matcher&#34;</span><span class="p">:</span>  <span class="s2">&#34;regex-list&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;HostsFile&#34;</span><span class="err">:</span> <span class="s2">&#34;./hosts_sample&#34;</span><span class="err">,</span>
  <span class="s2">&#34;MinimumTTL&#34;</span><span class="err">:</span> <span class="mi">0</span><span class="err">,</span>
  <span class="s2">&#34;DomainTTLFile&#34;</span> <span class="err">:</span> <span class="s2">&#34;./domain_ttl_sample&#34;</span><span class="err">,</span>
  <span class="s2">&#34;CacheSize&#34;</span> <span class="err">:</span> <span class="mi">99</span><span class="err">,</span> <span class="err">//緩存條數</span>
  <span class="s2">&#34;RejectQType&#34;</span><span class="err">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><p>個人比較推薦<a href="https://github.com/Unitech/pm2">PM2</a>作爲進程管理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">npm install pm2 -g
<span class="c1">#如果你沒nodejs可以使用 wget -qO- https://getpm2.com/install.sh | bash</span>
pm2 start overture-linux -- -c ./config.json
</code></pre></td></tr></table>
</div>
</div><h2 id="測試">測試</h2>
<p>最後的話就dig測試一下就好了拉，</p>
<style type="text/css">.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:#444;background:#e7f2fa}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.notice-title:before{margin-right:8px;font-family:"Font Awesome 5 Free",FontAwesome;font-weight:400}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning .notice-title:before{content:'\f071'}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info .notice-title:before{content:'\f05a'}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note .notice-title:before{content:'\f06a'}.notice.note{background:#e7f2fA}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip .notice-title:before{content:'\f058'}.notice.tip{background:#e6f9e6}</style><div class="notice tip" >
<p class="first notice-title"></p><p>用我的域名測試的話，我的域名是被污染了的</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1-Debian &lt;&lt;&gt;&gt; blog.mrsheep.xyz @127.0.0.1 -p <span class="m">15353</span>
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">18416</span>
<span class="p">;;</span> flags: qr rd ra ad<span class="p">;</span> QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: <span class="m">1</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: 0, flags:<span class="p">;</span> udp: <span class="m">512</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>blog.mrsheep.xyz.              IN      A

<span class="p">;;</span> ANSWER SECTION:
blog.mrsheep.xyz.       <span class="m">299</span>     IN      A       104.27.165.30
blog.mrsheep.xyz.       <span class="m">299</span>     IN      A       104.27.164.30

<span class="p">;;</span> Query time: <span class="m">535</span> msec
<span class="p">;;</span> SERVER: 127.0.0.1#15353<span class="o">(</span>127.0.0.1<span class="o">)</span>
<span class="p">;;</span> WHEN: Fri Nov <span class="m">15</span> 19:16:43 PST <span class="m">2019</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">109</span>
</code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CoreDNS配置</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/coredns-cfg/" />
            <id>https://blog.mrsheep.xyz/posts/coredns-cfg/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-09-19T19:27:40+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[CoreDNS是一個由GO語言編寫的輕量級開源DNS服務，跨平臺支持，並有一下幾個特性：
插件 配置簡單 跨平臺 通用 DNS 方案  官網： CoreDNS]]></summary>
            
                <content type="html"><![CDATA[<p>CoreDNS是一個由GO語言編寫的輕量級開源DNS服務，跨平臺支持，並有一下幾個特性：</p>
<ul>
<li>插件</li>
<li>配置簡單</li>
<li>跨平臺</li>
<li>通用 DNS 方案</li>
</ul>
<p>官網： <a href="https://coredns.io">CoreDNS</a></p>
<h1 id="配置">配置</h1>
<p>在<a href="https://github.com/coredns/coredns/releases">https://github.com/coredns/coredns/releases</a>下載最新的pre-built版本</p>
<h3 id="自行編譯">自行編譯</h3>
<p>如果你需要用到<code>Proxy</code>這個plugin的話，你需要自行編譯一份CoreDNS，具體原因參見<a href="https://github.com/coredns/coredns/issues/3234">ISSUE #3234</a>,編譯十分的簡單，但是網路環境的原因，推薦使用境外服務器編譯,但是當然，你要是相信國內的鏡像，我也不會攔着你</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/coredns/coredns
<span class="nb">cd</span> coredns
make
</code></pre></td></tr></table>
</div>
</div><p>在<code>make</code>之前，請編輯位於文件夾內的<code>plugin.cfg</code>文件，添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">proxy:github.com/coredns/proxy
</code></pre></td></tr></table>
</div>
</div><h1 id="corefile">Corefile</h1>
<p>CoreDNS使用Corefile作爲配置文件（和Caddyfile類似），<a href="https://coredns.io/manual/toc/#configuration">官方的Manual</a>是這麼說的</p>
<p><strong>That file consists of one or more Server Blocks. Each Server Block lists one or more Plugins. Those Plugins may be further configured with Directives.</strong></p>
<p>在這裏就廢話不多，需要其他的配置請參考Manual</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Clash 透明代理</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/clash-gateway/" />
            <id>https://blog.mrsheep.xyz/posts/clash-gateway/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-09-19T19:11:26+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[水文一篇，因爲家裏的網絡中有類似小米盒子，Apple TV這樣的設備，自身配置不是很好，鏈接效率會被降低，還不如在RPi 3B配置一個透明代理 我本來的設想是v2ray + iptables + dnsmasq，然後突然想到Clash自帶了一個簡單的DNS以及透明代理功能，再加上CoreDNS岂不是美滋滋？最后配合ROS指定的ip走透明代理，還要什麼自行車？]]></summary>
            
                <content type="html"><![CDATA[<p>水文一篇，因爲家裏的網絡中有類似小米盒子，Apple TV這樣的設備，自身配置不是很好，鏈接效率會被降低，還不如在RPi 3B配置一個透明代理
我本來的設想是v2ray + iptables + dnsmasq，然後突然想到Clash自帶了一個簡單的DNS以及透明代理功能，再加上CoreDNS岂不是美滋滋？最后配合ROS指定的ip走透明代理，還要什麼自行車？</p>
<h1 id="環境">環境</h1>
<p>需要準備的包,以apt为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install supervisor iptables-persistent net-tools curl wget vim  -y
</code></pre></td></tr></table>
</div>
</div><p>開啓轉發</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&#34;net.ipv6.conf.all.forwarding = 1&#34;</span> &gt;&gt; /etc/sysctl.conf <span class="o">&amp;&amp;</span> sysctl -p
</code></pre></td></tr></table>
</div>
</div><h1 id="clash配置">Clash配置</h1>
<p>隨便找一個目錄，cd進入
在<a href="https://github.com/Dreamacro/clash/releases/">Clash的Release頁面</a>找到你需要的版本，</p>
<p>樹莓派3B的話是<strong>clash-linux-armv6</strong></p>
<p>笔记本的话是<strong>amd64</strong></p>
<p>我最終還是換成了Thinkpad X201t作爲網關</p>
<p>wget到本地，其實也可以下載到電腦再sftp上來，節約時間（github日常抽風）
如果電腦上已經有Clash，可以同時將<strong>Country.mmdb</strong>上傳，這樣clash就不需要重新下載了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">gzip -d clash-linux-armv6-v0.15.0.gz
mv clash-linux-armv6-v0.15.0 clash-linux
chmod +x clash-linux

</code></pre></td></tr></table>
</div>
</div><p>在該目錄下創建一個名爲<strong>config.yaml</strong>的配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">port:</span> <span class="mi">8001</span>
<span class="err">socks-port:</span> <span class="mi">1081</span>
<span class="err">redir-port:</span> <span class="mi">9280</span>
<span class="err">allow-lan:</span> <span class="kc">true</span>
<span class="err">mode:</span> <span class="err">Rule</span>
<span class="err">log-level:</span> <span class="err">info</span>
<span class="err">external-controller:</span> <span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:</span><span class="mi">9090</span>
<span class="err">secret:</span> <span class="s2">&#34;&#34;</span>

<span class="err">dns:</span>
  <span class="err">enable:</span> <span class="kc">true</span>
  <span class="err">ipv</span><span class="mi">6</span><span class="err">:</span> <span class="kc">false</span>
  <span class="err">listen:</span> <span class="mf">0.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">:</span><span class="mi">53</span>
  <span class="err">enhanced-mode:</span> <span class="err">redir-host</span>
  <span class="err">nameserver:</span>
      <span class="err">-</span> <span class="err">tls://dns.rubyfish.cn:</span><span class="mi">853</span>
  <span class="err">fallback:</span>
      <span class="err">-</span> <span class="err">tls://</span><span class="mf">1.1</span><span class="err">.</span><span class="mf">1.1</span><span class="err">:</span><span class="mi">853</span>
      <span class="err">-</span> <span class="err">tls://dns.google</span>

<span class="err">Proxy:</span>
<span class="err">#</span> <span class="err">shadowsocks</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;SS&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">ss,</span> <span class="err">server:</span> <span class="nt">&#34;地址&#34;</span><span class="p">,</span> <span class="err">port:</span> <span class="err">端口,</span> <span class="err">cipher:</span> <span class="err">AEAD_CHACHA20_POLY1305,</span> <span class="err">password:</span> <span class="nt">&#34;密碼&#34;</span> <span class="p">}</span>

<span class="err">#</span> <span class="err">vmess</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;HK&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">vmess,</span> <span class="err">server:</span> <span class="err">地址,</span> <span class="err">port:</span> <span class="err">端口,</span> <span class="err">uuid:</span> <span class="err">你的uuid,</span> <span class="err">alterId:</span> <span class="err">16,</span> <span class="err">cipher:</span> <span class="err">auto,</span> <span class="err">network:</span> <span class="err">ws,</span> <span class="err">ws-path:</span> <span class="err">ws目錄,</span> <span class="err">tls:</span> <span class="err">true,</span> <span class="err">skip-cert-verify:</span> <span class="err">true</span> <span class="p">}</span>

<span class="err">Proxy</span> <span class="err">Group:</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;Proxy&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">select,</span> <span class="err">proxies:</span> <span class="err">[</span><span class="nt">&#34;HK&#34;</span><span class="err">]</span> <span class="p">}</span>

<span class="err">Rule:</span>
<span class="err">#</span> <span class="err">LAN</span>
<span class="err">-</span> <span class="err">DOMAIN-SUFFIX,local,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">127.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">172.16</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">12</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">192.168</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">16</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">17.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">100.64</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">10</span><span class="err">,DIRECT</span>

<span class="err">#</span> <span class="err">Final</span>
<span class="err">-</span> <span class="err">GEOIP,CN,DIRECT</span>
<span class="err">-</span> <span class="err">MATCH,Proxy</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ol>
<li>必須配置<code>redir-port</code>因爲你要做透明代理</li>
<li>DNS那裏配置<strong>監聽和enhanced-mode</strong></li>
<li>開啓Allow Lan並開放對應防火牆</li>
</ol>
<p>我配置的dns都是支持DoT的DNS服務器，國內的選擇紅魚，國外選擇CF，具體Clash請求DNS原理請參考Github頁面</p>
<h1 id="coredns">CoreDNS</h1>
<p>参考文章 <a href="link-to-coredns">CoreDNS配置</a></p>
<p>CoreDNS需要开在高端口，或者修改iptables</p>
<p>请将上面的配置文件中的dns部分改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">dns:</span>
  <span class="err">enable:</span> <span class="kc">true</span>
  <span class="err">ipv</span><span class="mi">6</span><span class="err">:</span> <span class="kc">false</span>
  <span class="err">listen:</span> <span class="mf">0.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">:</span><span class="mi">53</span>
  <span class="err">enhanced-mode:</span> <span class="err">redir-host</span>
  <span class="err">nameserver:</span>
      <span class="err">-</span> <span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:你的Coredns端口</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="iptables配置">iPtables配置</h1>
<p>我的本地網段是192.168.88.0/16</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">iptables -t nat -N Clash
//創建名爲Clash的規則
iptables -t nat -A Clash -d 192.168.88.0/16 -j RETURN
//不對本地進行代理
iptables -t nat -A Clash -p tcp -j REDIRECT --to-ports 9280
//這裏是你的redirport
iptables -t nat -A PREROUTING -p tcp -j Clash

</code></pre></td></tr></table>
</div>
</div><p>然後<code>netfilter-persistent save</code>持久化</p>
<p>之後你就可以愉快的開啓Clash了
<code>./clash-linux -d .</code>
沒有Country.MMDB會自動下載，沒有報錯的話就說明配置完成了
可以把設備的DNS和Gateway都改成樹莓派的ip測試一下</p>
<h3 id="守護進程">守護進程</h3>
<h4 id="supervisor">Supervisor</h4>
<p>新建一個supervisor配置
<code>vim /etc/supervisor/conf.d/clash.conf</code>
內容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[supervisord]
nodaemon=false

[program:clash]
priority=1
directory=clash所在的目錄
command=clash所在的目錄/clash-linux -d .
autorestart=true

</code></pre></td></tr></table>
</div>
</div><h4 id="pm2">PM2</h4>
<p>官方推荐的进程管理器，十分的方便，安裝需要npm，天朝網路出口常年故障，能不能裝上隨緣</p>
<p>項目地址：  [github.com/Unitech/pm2][https://github.com/Unitech/pm2]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">//安裝pm2
npm install pm2 -g
如果沒有nodejs
wget -qO- https://getpm2.com/install.sh <span class="p">|</span> bash
//啓動程序
pm2 start app.js
//查看正在運行的程序
pm2 list
//查看日誌
pm2 logs
</code></pre></td></tr></table>
</div>
</div><h1 id="ros指定ip走透明代理">ROS指定ip走透明代理</h1>
<p>這部分的話參考<a href="http://www.myxzy.com/post-461.html">RouterOS指定内网IP走指定接口</a>
因爲不想改變現有的網絡結構，所以只讓指定的內網ip走樹莓派
在RouterOS中
IP - Firewall 中切換 Mangle 選項，添加一條新的規則
General 选项卡中，Chain 选择 prerouting ，Src.Address 寫小米盒子等需要代理的ip
如只需要特定协议通过指定接口就需要在protocol中选择对应的协议，全局则不选
Action 选项卡，在 Action 下拉菜单中选择 mark routing ，New Routing Mark 中填入该路由标记名称，Proxy_to_pi
如果多個設備的話，可以考慮配置個adress list，我暫時只有1個，就懶得啦
之後在IP - Routes配置路由，添加一條新的規則</p>
<p>但是我個人更加推薦全局應用，將dns和網關全部更改爲Clash的ip地址</p>
<h1 id="參考文章">參考文章</h1>
<p><a href="http://www.myxzy.com/post-461.html">RouterOS指定内网IP走指定接口</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Caddy/Nginx &#43; V2Ray</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/v2ray-ws/" />
            <id>https://blog.mrsheep.xyz/posts/v2ray-ws/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-09-15T13:37:25+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[相比較於之前的Nginx，Caddy v1是一個更加輕量級，安裝更加方便，配置超級簡單的web server，並且支持自動申請lets encrypt證書（雖然我用不到） Caddy配置十分的簡單，幾分鐘即可以完成配置。本文使用Caddy V1實現，V2有一種開倒車的感覺，配置越來越複雜。]]></summary>
            
                <content type="html"><![CDATA[<p>相比較於之前的Nginx，Caddy v1是一個更加輕量級，安裝更加方便，配置超級簡單的web server，並且支持自動申請lets encrypt證書（雖然我用不到）
Caddy配置十分的簡單，幾分鐘即可以完成配置。本文使用Caddy V1實現，V2有一種開倒車的感覺，配置越來越複雜。</p>
<h1 id="caddy">Caddy</h1>
<h3 id="下載安裝">下載安裝</h3>
<p><a href="https://caddyserver.com/download">Caddy官網</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl https://getcaddy.com <span class="p">|</span> bash -s personal http.forwardproxy,http.proxyprotocol
</code></pre></td></tr></table>
</div>
</div><p>創建service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl -s https://raw.githubusercontent.com/GEM7/My_scripts/master/caddy/caddy.service -o /etc/systemd/system/caddy.service
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>Unit<span class="o">]</span>
<span class="c1">#paste this to /usr/lib/systemd/system/caddy.service</span>
<span class="nv">Description</span><span class="o">=</span>Caddy Service
<span class="nv">After</span><span class="o">=</span>network.target
<span class="nv">Wants</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">PIDFile</span><span class="o">=</span>/var/run/caddy.pid
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/caddy -conf /etc/Caddyfile
<span class="nv">Restart</span><span class="o">=</span>on-failure

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></td></tr></table>
</div>
</div><h3 id="配置">配置</h3>
<p>配置真心超級簡單，如果需要使用自己的證書，比如CF的證書，請將證書和私鑰保存本地，在配置文件中引用即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">你的域名:</span><span class="mi">443</span> <span class="p">{</span>
    <span class="err">root</span> <span class="err">/www</span>
    <span class="err">gzip</span>
    <span class="err">index</span> <span class="err">index.html</span>
    <span class="err">tls</span> <span class="err">證書路徑</span> <span class="err">私鑰路徑</span>
    <span class="err">//如果需要自動申請的話，請移除上面這行</span>
    <span class="err">proxy</span> <span class="err">僞裝路徑</span> <span class="err">localhost:9999</span> <span class="err">{</span>
           <span class="err">websocket</span>
           <span class="err">header_upstream</span> <span class="err">-Origin</span>
    <span class="p">}</span>
<span class="err">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="關於證書">關於證書</h4>
<p>請參考另一篇文章：Caddy SSL</p>
<h1 id="nginx">Nginx</h1>
<p>我之前使用是Nginx，但是由於體積大，配置複雜所以選用Caddy，但是這裏還是附上Nginx配置，僅供參考</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">server
<span class="o">{</span>
    listen 80<span class="p">;</span>
    listen <span class="m">443</span> ssl http2<span class="p">;</span>
    server_name 你的域名 *.你的域名<span class="p">;</span>
    index index.php index.html index.htm default.php default.htm default.html<span class="p">;</span>
    root /www/wwwroot/你的域名<span class="p">;</span>
    
    <span class="c1">#SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span>
    <span class="c1">#error_page 404/404.html;</span>
    <span class="c1">#HTTP_TO_HTTPS_START</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$server_port</span> !~ 443<span class="o">){</span>
        rewrite ^<span class="o">(</span>/.*<span class="o">)</span>$ https://<span class="nv">$host$1</span> permanent<span class="p">;</span>
    <span class="o">}</span>
    <span class="c1">#HTTP_TO_HTTPS_END</span>
    ssl_certificate    /etc/letsencrypt/live/你的域名/fullchain.pem<span class="p">;</span>
    ssl_certificate_key    /etc/letsencrypt/live/你的域名/privkey.pem<span class="p">;</span>
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="p">;</span>
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE<span class="p">;</span>
    ssl_prefer_server_ciphers on<span class="p">;</span>
    ssl_session_cache shared:SSL:10m<span class="p">;</span>
    ssl_session_timeout 10m<span class="p">;</span>
    error_page <span class="m">497</span>  https://<span class="nv">$host$request_uri</span><span class="p">;</span>

    <span class="c1">#SSL-END</span>
    
    <span class="c1">#ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span>
    error_page <span class="m">404</span> /404.html<span class="p">;</span>
    error_page <span class="m">502</span> /502.html<span class="p">;</span>
    <span class="c1">#ERROR-PAGE-END</span>
    
    <span class="c1">#PHP-INFO-START  PHP引用配置，可以注释或修改</span>
    include enable-php-72.conf<span class="p">;</span>
    <span class="c1">#PHP-INFO-END</span>
    
    <span class="c1">#REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span>
    include /www/server/panel/vhost/rewrite/你的域名.conf<span class="p">;</span>
    <span class="c1">#REWRITE-END</span>
    
    <span class="c1">#禁止访问的文件或目录</span>
    location ~ ^/<span class="o">(</span><span class="se">\.</span>user.ini<span class="p">|</span><span class="se">\.</span>htaccess<span class="p">|</span><span class="se">\.</span>git<span class="p">|</span><span class="se">\.</span>svn<span class="p">|</span><span class="se">\.</span>project<span class="p">|</span>LICENSE<span class="p">|</span>README.md<span class="o">)</span>
    <span class="o">{</span>
        <span class="k">return</span> 404<span class="p">;</span>
    <span class="o">}</span>
    
    <span class="c1">#一键申请SSL证书验证目录相关设置</span>
    location ~ <span class="se">\.</span>well-known<span class="o">{</span>
        allow all<span class="p">;</span>
    <span class="o">}</span>
    
    location ~ .*<span class="se">\.</span><span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="p">|</span>png<span class="p">|</span>bmp<span class="p">|</span>swf<span class="o">)</span>$
    <span class="o">{</span>
        expires      30d<span class="p">;</span>
        error_log off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>
    
    location ~ .*<span class="se">\.</span><span class="o">(</span>js<span class="p">|</span>css<span class="o">)</span>?$
    <span class="o">{</span>
        expires      12h<span class="p">;</span>
        error_log off<span class="p">;</span>
        access_log off<span class="p">;</span> 
    <span class="o">}</span>
    access_log  /www/wwwlogs/你的域名.log<span class="p">;</span>
    error_log  /www/wwwlogs/你的域名.error.log<span class="p">;</span>
             location /ws/ <span class="o">{</span>   
             proxy_redirect off<span class="p">;</span>
             proxy_pass http://127.0.0.1:你的端口<span class="p">;</span> 
             proxy_http_version 1.1<span class="p">;</span>
             proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
             proxy_set_header Connection <span class="s2">&#34;upgrade&#34;</span><span class="p">;</span>
             proxy_set_header Host <span class="nv">$http_host</span><span class="p">;</span>            
          <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>證書申請之類的請自行參考使用<strong>acme.sh</strong></p>
<h3 id="websocket解決bad-request">WebSocket解決Bad Request</h3>
<p>轉自<a href="https://www.ivyseeds.cf/websockets2/">从零开始安装爱国工具指南（十四）V2Ray补充、WebSockets模式补完</a></p>
<h4 id="修改nginxconf">修改nginx.conf</h4>
<p>文件位<code>于/usr/local/nginx/conf/</code></p>
<p>在代码<code>http{}</code>段里添加一句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">proxy_intercept_errors on;
</code></pre></td></tr></table>
</div>
</div><p>保存退出即可</p>
<h4 id="修改vhost文件">修改vhost文件</h4>
<p>文件位于<code>/usr/local/nginx/conf/vhost/</code></p>
<p>在443端口的配置里加一句，比如說我跳轉回到<a href="https://mrsheep.win">mrsheep.win</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">error_page 400 = https://www.mrsheep.win;
</code></pre></td></tr></table>
</div>
</div><p>保存退出重启nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">service nginx restart
</code></pre></td></tr></table>
</div>
</div><h1 id="v2ray">V2Ray</h1>
<h2 id="安裝">安裝</h2>
<h3 id="官方安裝">官方安裝</h3>
<p><strong>如果你想要使用管理腳本等，請直接跳過本節</strong>
使用官方安裝腳本: <a href="https://www.v2ray.com/chapter_00/install.html#linuxscript">www.v2ray.com/chapter_00/install.html#linuxscript</a>
<strong>請使用root用戶運行一下腳本</strong>
运行下面的指令下载并安装  V2Ray。当 yum 或 apt-get 可用的情况下，此脚本会自动安装 unzip 和 daemon。这两个组件是安装 V2Ray  的必要组件。如果你使用的系统不支持 yum 或 apt-get，请自行安装 unzip 和 daemon</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">bash &lt;<span class="o">(</span>curl -L -s https://install.direct/go.sh<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>此脚本会自动安装以下文件：</strong></p>
<p><code>/usr/bin/v2ray/v2ray</code>：V2Ray 程序；
<code>/usr/bin/v2ray/v2ctl</code>：V2Ray 工具；
<code>/etc/v2ray/config.json</code>：配置文件；
<code>/usr/bin/v2ray/geoip.dat</code>：IP 数据文件
<code>/usr/bin/v2ray/geosite.dat</code>：域名数据文件
配置<code>/etc/v2ray/config.json</code>即可</p>
<h3 id="腳本">腳本</h3>
<p>這裏僅僅使用Multi-V2Ray，其他的請自行參考對應wiki</p>
<h4 id="multi-v2ray">Multi-V2Ray</h4>
<p>項目地址：https://github.com/Jrohy/multi-v2ray
運行命令安裝，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">source</span> &lt;<span class="o">(</span>curl -sL https://git.io/fNgqx<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>部分VPS安裝完成之後提示找不到v2ray命令，請運行<code>/usr/local/multi-v2ray/v2ray</code></p>
<h5 id="命令行參數">命令行參數：</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">   v2ray -h                   查看帮助
   v2ray -v                   查看版本信息
   v2ray start                启动 V2Ray
   v2ray stop                 停止 V2Ray
   v2ray restart              重启 V2Ray
   v2ray status               查看 V2Ray 运行状态
   v2ray log                  查看 V2Ray 运行日志
   v2ray update               更新 V2Ray 到最新Release版本
   v2ray update <span class="o">[</span>version<span class="o">]</span>     更新 V2Ray 到特定版本
   v2ray update.sh            更新 multi-v2ray 脚本
   v2ray update.sh <span class="o">[</span>version<span class="o">]</span>  更新 multi-v2ray 到特定版本
   v2ray add                  新增mkcp + 随机一种 <span class="o">(</span>srtp <span class="p">|</span> wechat-video <span class="p">|</span> utp<span class="o">)</span> header伪装的端口<span class="o">(</span>Group<span class="o">)</span>
   v2ray add <span class="o">[</span>wechat<span class="p">|</span>utp<span class="p">|</span>srtp<span class="p">|</span>dtls<span class="p">|</span>wireguard<span class="p">|</span>socks<span class="p">|</span>mtproto<span class="p">|</span>ss<span class="o">]</span>     新增一种协议的组，端口随机,如 v2ray add utp 为新增utp协议
   v2ray del                  删除端口组
   v2ray info                 查看配置
   v2ray port                 修改端口
   v2ray tls                  修改tls
   v2ray tfo                  修改tcpFastOpen
   v2ray stream               修改传输协议
   v2ray stats                iptables流量统计
   v2ray clean                清理日志
</code></pre></td></tr></table>
</div>
</div><p>更多請參考: <a href="https://github.com/Jrohy/multi-v2ray/wiki">https://github.com/Jrohy/multi-v2ray/wiki</a></p>
<h2 id="配置-1">配置</h2>
<h3 id="tls">TLS</h3>
<p>證書的話可以直接使用Caddy自動申請Let‘s Encrypt的證書，3個月續命一次即可</p>
<p>其他的話如使用Cloudflare簽發的證書，請參考上面 [Caddy配置][配置]</p>
<h3 id="dns">DNS</h3>
<p><strong>推荐的DNS服务商（免费）：Geoscaling，Cloudflare（仅使用DNS）</strong>
不建议使用国内解析服务，VPS提供的DNS服务（例如Conoha的DNS解析）</p>
<h3 id="bbr">BBR</h3>
<h4 id="換核">換核</h4>
<p>如果你不需要，請直接跳過</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">//导入key
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
//安装 elrepo 的yum源
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
//安装内核
yum --enablerepo<span class="o">=</span>elrepo-kernel install kernel-ml-devel kernel-ml -y
//查看系统启动项：
cat /boot/grub2/grub.cfg <span class="p">|</span>grep menuentry
//设置最新版本内核为默认启动：
grub2-set-default <span class="err">&#39;</span>最新的內核，如CentOS Linux <span class="o">(</span>4.8.5-1.el7.elrepo.x86_64<span class="o">)</span> <span class="m">7</span> <span class="o">(</span>Core<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>注：請一定等待安裝完成</strong></p>
<p>此时，查看默认启动的系统版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">grub2-editenv list
</code></pre></td></tr></table>
</div>
</div><p>显示为&rsquo;CentOS Linux (4.8.5-1.el7.elrepo.x86_64) 7 (Core)&lsquo;或類似，reboot之后再次查看 <code>uname -r</code></p>
<h4 id="開啓bbr">開啓BBR</h4>
<p>複製如下命令即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">cat &gt;&gt;/etc/sysctl.conf <span class="s">&lt;&lt; EOF
</span><span class="s">net.core.default_qdisc=fq
</span><span class="s">net.ipv4.tcp_congestion_control=bbr
</span><span class="s">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>再继续内核参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sysctl -p
</code></pre></td></tr></table>
</div>
</div><p>返回類似結果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr
</code></pre></td></tr></table>
</div>
</div><p>最后保险起见，复核一下BBR是否生效：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">sysctl net.ipv4.tcp_available_congestion_control

lsmod | grep bbr
</code></pre></td></tr></table>
</div>
</div><p>返回類似</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">net.ipv4.tcp_available_congestion_control = reno cubic bbr

tcp_bbr                20480  41 
</code></pre></td></tr></table>
</div>
</div><h4 id="cdn">CDN</h4>
<p>個人不需要套CDN，當前地區封鎖不嚴重</p>
<h4 id="配置模板">配置模板</h4>
<p>我的部分配置可以參考</p>
<h5 id="服務端">服務端</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;inbound&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span> 
        <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span>
        <span class="p">},</span>
      <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/ws/&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span> 
    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">你的端口</span><span class="p">,</span> 
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;clients&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> 
          <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;你的uuid&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;level&#34;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span> 
  <span class="nt">&#34;outboundDetour&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;blocked&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;blackhole&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">],</span> 
  <span class="nt">&#34;outbound&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">},</span> 
  <span class="nt">&#34;log&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;access&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/access.log&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;loglevel&#34;</span><span class="p">:</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/error.log&#34;</span>
  <span class="p">},</span> 
  <span class="nt">&#34;routing&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;rules&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;0.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;10.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;100.64.0.0/10&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;127.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;169.254.0.0/16&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;172.16.0.0/12&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.0.0.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.0.2.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.168.0.0/16&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;198.18.0.0/15&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;198.51.100.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;203.0.113.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;::1/128&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;fc00::/7&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;fe80::/10&#34;</span>
          <span class="p">],</span> 
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;blocked&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span> 
    <span class="nt">&#34;strategy&#34;</span><span class="p">:</span> <span class="s2">&#34;rules&#34;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="客戶端">客戶端</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;policy&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;levels&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;0&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;uplinkOnly&#34;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;dns&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;servers&#34;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;localhost&#34;</span><span class="p">,</span>
      <span class="s2">&#34;8.8.8.8&#34;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&#34;outboundDetour&#34;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span>
      <span class="nt">&#34;tag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;inbound&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;listen&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">1081</span><span class="p">,</span>
    <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;socks&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;auth&#34;</span> <span class="p">:</span> <span class="s2">&#34;noauth&#34;</span><span class="p">,</span>
      <span class="nt">&#34;udp&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&#34;ip&#34;</span> <span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;inboundDetour&#34;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;listen&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;allocate&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;strategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;always&#34;</span><span class="p">,</span>
        <span class="nt">&#34;refresh&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&#34;concurrency&#34;</span> <span class="p">:</span> <span class="mi">3</span>
      <span class="p">},</span>
      <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">8001</span><span class="p">,</span>
      <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;http&#34;</span><span class="p">,</span>
      <span class="nt">&#34;tag&#34;</span> <span class="p">:</span> <span class="s2">&#34;httpDetour&#34;</span><span class="p">,</span>
      <span class="nt">&#34;domainOverride&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;http&#34;</span><span class="p">,</span>
        <span class="s2">&#34;tls&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;streamSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>

      <span class="p">},</span>
      <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;timeout&#34;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;log&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;error&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/var\/folders\/jt\/dc88j3317917cz1n8mxqj8jc0000gn\/T\/cenmrev.v2rayx.log.C2EAD579-EFCE-4BEC-91A2-61E4760E1219\/error.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;loglevel&#34;</span> <span class="p">:</span> <span class="s2">&#34;debug&#34;</span><span class="p">,</span>
    <span class="nt">&#34;access&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/var\/folders\/jt\/dc88j3317917cz1n8mxqj8jc0000gn\/T\/cenmrev.v2rayx.log.C2EAD579-EFCE-4BEC-91A2-61E4760E1219\/access.log&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;routing&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;strategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;rules&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;domainStrategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;IPIfNonMatch&#34;</span><span class="p">,</span>
      <span class="nt">&#34;rules&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;domain&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;localhost&#34;</span>
          <span class="p">],</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span><span class="p">,</span>
          <span class="nt">&#34;ip&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;geoip:private&#34;</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;outbound&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;sendThrough&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;mux&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;enabled&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&#34;concurrency&#34;</span> <span class="p">:</span> <span class="mi">8</span>
    <span class="p">},</span>
    <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;vnext&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;address&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span><span class="p">,</span>
          <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
          <span class="nt">&#34;users&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&#34;id&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的UUID&#34;</span><span class="p">,</span>
              <span class="nt">&#34;alterId&#34;</span> <span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
              <span class="nt">&#34;security&#34;</span> <span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
              <span class="nt">&#34;level&#34;</span> <span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="nt">&#34;remark&#34;</span> <span class="p">:</span> <span class="s2">&#34;這個&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&#34;streamSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;wsSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;path&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/ws\/&#34;</span><span class="p">,</span><span class="err">你的path</span>
        <span class="nt">&#34;headers&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;Host&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;tlsSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;serverName&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span><span class="p">,</span>
        <span class="nt">&#34;allowInsecure&#34;</span> <span class="p">:</span> <span class="kc">false</span>
      <span class="p">},</span>
      <span class="nt">&#34;httpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;path&#34;</span> <span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;host&#34;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="s2">&#34;&#34;</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;tcpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;header&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;none&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;kcpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;header&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;none&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;mtu&#34;</span> <span class="p">:</span> <span class="mi">1350</span><span class="p">,</span>
        <span class="nt">&#34;congestion&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">&#34;tti&#34;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nt">&#34;uplinkCapacity&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&#34;writeBufferSize&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&#34;readBufferSize&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&#34;downlinkCapacity&#34;</span> <span class="p">:</span> <span class="mi">20</span>
      <span class="p">},</span>
      <span class="nt">&#34;network&#34;</span> <span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
      <span class="nt">&#34;security&#34;</span> <span class="p">:</span> <span class="s2">&#34;tls&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="參考鏈接">參考鏈接</h1>
<p><a href="https://www.v2ray.com">V2Ray項目</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">V2Ray Force Ipv4</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/v2ray-force-ipv4/" />
            <id>https://blog.mrsheep.xyz/posts/v2ray-force-ipv4/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-09-15T02:11:05+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[我在机器上开了6to4的隧道，本來是準備用來廣播我自己的ipv6，但是這樣子导致V2Ray流量会被转发到HE的隧道ip，最后NF会直接ban掉HE的ip 所以我不废话了…]]></summary>
            
                <content type="html"><![CDATA[<p>我在机器上开了6to4的隧道，本來是準備用來廣播我自己的ipv6，但是這樣子导致V2Ray流量会被转发到HE的隧道ip，最后NF会直接ban掉HE的ip
所以我不废话了&hellip;</p>
<h1 id="freedom">Freedom</h1>
<p>需要用到的就是Freedom是這個協議，從V2ray官網上有如下解釋：
<strong>Freedom 是一个出站协议，可以用来向任意网络发送（正常的） TCP 或 UDP 数据</strong>
在目标地址为域名时，Freedom 可以直接向此域名发出连接（&ldquo;AsIs&rdquo;），或者将域名解析为 IP 之后再建立连接（&ldquo;UseIP&rdquo;、&ldquo;UseIPv4&rdquo;、&ldquo;UseIPv6&rdquo;）。解析 IP 的步骤会使用 V2Ray 内建的 DNS。默认值为&quot;AsIs&rdquo;。</p>
<ol>
<li>(V2Ray 4.6+) 当使用 <strong>&ldquo;UseIP&rdquo;</strong> 模式，并且出站连接配置中指定了sendThrough时，Freedom 会根据sendThrough的值自动判断所需的IP类型，IPv4 或 IPv6。</li>
<li>(V2Ray 4.7+) 当使用 <strong>&ldquo;UseIPv4&rdquo;</strong> 或 <strong>&ldquo;UseIPv6&rdquo;</strong> 模式时，Freedom 会只使用对应的 IPv4 或 IPv6 地址。当sendThrough指定了不匹配的本地地址时，将导致连接失败</li>
</ol>
<p>需要用到這個協議:<a href="https://www.v2ray.com/chapter_02/protocols/freedom.html">V2Ray文檔</a>
關於配置文檔格式:<a href="https://www.v2ray.com/chapter_02/01_overview.html#outboundobject">V2Ray文檔</a></p>
<h1 id="具體配置">具體配置</h1>
<p>一點都不複雜，和本部分沒有關係的都已經去掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">  &#34;inbounds&#34;: [
    {
      &#34;port&#34;: 29708,
      &#34;protocol&#34;: &#34;vmess&#34;,
      &#34;settings&#34;:{
        &#34;clients&#34;: [
        {
          &#34;id&#34;: &#34;uuid&#34;,
          &#34;alterId&#34;: 16,
        }
      ]
    },
      &#34;streamSettings&#34;: {
        &#34;network&#34;: &#34;ws&#34;,
        &#34;security&#34;: &#34;auto&#34;,
        &#34;wsSettings&#34;: {
          &#34;path&#34;: &#34;/&#34;,
          &#34;connectionReuse&#34;:true,
          &#34;headers&#34;:{
          }
        },
      &#34;disableInsecureEncryption&#34;: true
    }
  }
],
  &#34;outbound&#34;:{
      &#34;sendThrough&#34;: &#34;0.0.0.0&#34;,
      &#34;protocol&#34;: &#34;freedom&#34;,
      &#34;settings&#34;: {
          &#34;domainStrategy&#34;: &#34;UseIPv4&#34;,
          &#34;userLevel&#34;: 0
      }
    }
}

</code></pre></td></tr></table>
</div>
</div><p>其實這又是水文一篇</p>
<h1 id="參考">參考</h1>
<p>V2ray.com</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">廣播你的ip</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/broadcast-ip/" />
            <id>https://blog.mrsheep.xyz/posts/broadcast-ip/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-09-13T17:47:00+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[我的AS號和IP都已經沾灰了，再不用就要徹底忘了。
在你開始之前，請確定你的ISP 为你分配了一个公网 IPv4, 並且你拥有 ASN 和一个至少为 / 48 的 ipv6 block]]></summary>
            
                <content type="html"><![CDATA[<p>我的AS號和IP都已經沾灰了，再不用就要徹底忘了。</p>
<p>在你開始之前，請確定你的ISP 为你分配了一个公网 IPv4, 並且你拥有 ASN 和一个至少为 / 48 的 ipv6 block</p>
<h1 id="開始之前的一點py交易">開始之前的一點PY交易</h1>
<p>準備Py之前，請確定如下內容(來自HE),不然你去PY也沒有意義</p>
<p><strong>Through this interface you can request a static, IPv6 BGP tunnel that will receive full transit routes from AS6939 and be able to announce your RIR allocated IPv6 space. To minimize any issues or delays in turnup please note the following:
Your ASN must be allocated from a RIR. (Public ASNs only)
We must be able to validate that this is your ASN/address space (SWIP entries or a LoA will do)
We will prefix-filter your BGP session. If you are adding new announcements, please let us know via an email to <a href="mailto:ipv6@he.net">ipv6@he.net</a>.
We do not filter traffic. However, we do reserve the right to filter at our sole discretion as needed.
If this is your first tunnel for this ASN, you should receive a message to your account&rsquo;s email address. Please follow the instructions in the email to complete the verification process. During this period the tunnel and BGP session will be unavailable. If you have not heard from us within 48 hours then please email <a href="mailto:ipv6@he.net">ipv6@he.net</a>.
地址：<a href="https://blog.ni-co.moe/public/563.html">tunnelbroker.net</a></strong></p>
<p>然後你就可以去註冊一個帳號，之後创建一个 BGP 隧道，選擇最近的节点，填寫你的ASN以及IP段
最後你需要一封Authorize Letter（LoA）
提交24小時左右PY交易就會成功</p>
<h1 id="創建隧道">創建隧道</h1>
<p>訪問tunnelbroker</p>
<p><code>Tunnel - Example Config - Linux net-tools</code>
配置大概張這個樣子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ifconfig sit0 inet6 tunnel ::0.0.0.0
ifconfig sit1 up
ifconfig sit1 inet6 add ::::/64
route -A inet6 add ::/0 dev sit1
</code></pre></td></tr></table>
</div>
</div><h1 id="廣播">廣播</h1>
<h3 id="安裝bird6">安裝bird6</h3>
<p><code>yum install bird6 -y</code></p>
<p>或者</p>
<p><code>apt -y install bird</code></p>
<h3 id="編輯-bird6conf">編輯 <code>bird6.conf</code></h3>
<p>注意：</p>
<ol>
<li>router id請寫本機ip</li>
<li>local as是你的asn</li>
<li>source add是HE給你的client ip</li>
<li>neighbor是 HE分配的 server ip,6939 为 he 的 asn 号码</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">router id 本機ip;
protocol bgp he
{
        local as 208884;
        source address Client_ip;
        import none;
        export all;
        graceful restart on;
        multihop 2;
        neighbor server_ip as 6939;
}
protocol static
{
    route  你的ip段 via cleint_ip;
}
protocol device
{
        scan time 5;
}
</code></pre></td></tr></table>
</div>
</div><p>之後保存推出，重載bird配置，或者重啓bird即可
最後<code>birdc6 show proto all</code>
顯示Established即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">name     proto    table    state  since       info
he       BGP      master   up     17:40:47    Established   
  Preference:     100
  Input filter:   REJECT
  Output filter:  ACCEPT
  Routes:         0 imported, 1 exported, 0 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:           3457          0       3457          0          0
    Import withdraws:            0          0        ---       3457          0
    Export updates:              1          0          0        ---          1
    Export withdraws:            0        ---        ---        ---          0
  BGP state:          Established
    Neighbor address: 2001:470:d6:e::1
    Neighbor AS:      6939
    Neighbor ID:      64.71.128.26
    Neighbor caps:    refresh AS4
    Session:          external multihop AS4
    Source address:   2001:470:d6:e::2
    Hold timer:       179/180
    Keepalive timer:  52/60

static1  Static   master   up     17:40:42    
  Preference:     200
  Input filter:   ACCEPT
  Output filter:  REJECT
  Routes:         1 imported, 0 exported, 1 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:              1          0          0          0          1
    Import withdraws:            0          0        ---          0          0
    Export updates:              0          0          0        ---          0
    Export withdraws:            0        ---        ---        ---          0

device1  Device   master   up     17:40:42    
  Preference:     240
  Input filter:   ACCEPT
  Output filter:  REJECT
  Routes:         0 imported, 0 exported, 0 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:              0          0          0          0          0
    Import withdraws:            0          0        ---          0          0
    Export updates:              0          0          0        ---          0
    Export withdraws:            0        ---        ---        ---          0
</code></pre></td></tr></table>
</div>
</div><h1 id="宣告">宣告</h1>
<p>創建虛擬網卡並分配ip</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">    ip link add dev dummy1 type dummy
    ip link set dummy1 up
    ip addr add dev dummy1 2001:2333:2333::1/128
</code></pre></td></tr></table>
</div>
</div><p>編輯<strong>bird6.conf</strong>加入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">protocol direct
{
    interface &#34;dummy*&#34;;
    import all;
}
</code></pre></td></tr></table>
</div>
</div><p>之後</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">systemctl restart bird6
</code></pre></td></tr></table>
</div>
</div><p>這樣 bird 將查詢所有 dummy 开头的网卡的 ip 并宣告这些 ip
<code>birdc6 show route</code> 查看</p>
<h1 id="參考">參考</h1>
<p><a href="https://blog.ni-co.moe/public/563.html">IP 广播：在不借助你的 ISP 进行任何操作的情况下，广播 (组播) 你的 IPv6</a>
<a href="https://blog.ni-co.moe/public/560.html">IP 广播：使用 bird 广播 (组播) ipv6</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">V2Ray中轉</title>
            <link rel="alternate" type="text/html" href="https://blog.mrsheep.xyz/posts/v2ray-fw/" />
            <id>https://blog.mrsheep.xyz/posts/v2ray-fw/</id>
            <updated>2019-11-16T17:57:52+08:00</updated>
            <published>2019-05-10T16:51:13+08:00</published>
            <author>
                    <name>MrSheep</name>
                    <uri>https://blog.mrsheep.xyz</uri>
                    <email>admin@mrsheep.xyz</email>
                    </author>
            <rights>![CC BY-NC-SA 4.0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg)  ![996 ICU](https://img.shields.io/badge/link-996.icu-red.svg)</rights><summary type="html"><![CDATA[國內到我HE的小機線路峰值ping偏高，但是ip很清真，剛好我的HK小機的ISP和HE有transit 方案如下
使用UUID1鏈接中轉服務器，將流量路由到#1服務器 使用UUID2鏈接中轉服務器，將流量路由到#2服務器 使用UUID3鏈接中轉服務器，直接使用當前服務器訪問]]></summary>
            
                <content type="html"><![CDATA[<p>國內到我HE的小機線路峰值ping偏高，但是ip很清真，剛好我的HK小機的ISP和HE有transit
方案如下</p>
<ol>
<li>使用UUID1鏈接中轉服務器，將流量路由到<code>#1</code>服務器</li>
<li>使用UUID2鏈接中轉服務器，將流量路由到<code>#2</code>服務器</li>
<li>使用UUID3鏈接中轉服務器，直接使用當前服務器訪問</li>
</ol>
<h1 id="服務器配置">服務器配置</h1>
<h3 id="末端服務器配置">末端服務器配置</h3>
<p>參考<a href="https://blog.mrsheep.xyz/2019/09/15/WebServer-V2Ray/">Caddy/Nginx + V2Ray</a></p>
<h3 id="中轉服務器">中轉服務器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="s2">&#34;log&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;access&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/access.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/error.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;loglevel&#34;</span><span class="p">:</span> <span class="s2">&#34;warnings&#34;</span>
  <span class="p">}</span><span class="err">,</span>
   <span class="s2">&#34;inbounds&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">端口</span><span class="p">,</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:{</span>
        <span class="nt">&#34;clients&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID1&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email1（隨意寫）&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID2&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email2（隨意）&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID3&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email3（隨意）&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="err">//鏈接中轉服務器的協議爲wss</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/你的path/&#34;</span><span class="p">,</span>
          <span class="nt">&#34;connectionReuse&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
          <span class="nt">&#34;headers&#34;</span><span class="p">:{</span>
            <span class="nt">&#34;Host&#34;</span><span class="p">:</span><span class="s2">&#34;域名&#34;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">},</span>
      <span class="nt">&#34;disableInsecureEncryption&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;outbound&#34;</span><span class="err">:</span><span class="p">{</span>
  <span class="err">//使用UUID3，不進行中轉</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;outboundDetour&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="err">//使用UUID1，路由至下一節點，下一節點使用普通tcp</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;vnext&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;你的ip&#34;</span><span class="p">,</span>
            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">端口</span><span class="p">,</span>
            <span class="nt">&#34;users&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;和下一節點一致&#34;</span><span class="p">,</span>
                <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;tag1之後會用到&#34;</span>
    <span class="p">},</span>
    <span class="err">//使用UUID</span><span class="mi">2</span><span class="err">，路由至下一節點，採用wss</span>
    <span class="p">{</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;vnext&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;域名&#34;</span><span class="p">,</span>
            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
            <span class="nt">&#34;users&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;和下一節點一致&#34;</span><span class="p">,</span>
                <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;tls&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;connectionReuse&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
          <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/你的path/&#34;</span><span class="p">,</span>
          <span class="nt">&#34;headers&#34;</span><span class="p">:{</span>
            <span class="nt">&#34;Host&#34;</span><span class="p">:</span><span class="s2">&#34;域名&#34;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;tag2之後會用到，和上面的不一樣&#34;</span>
    <span class="p">}]</span><span class="err">,</span>
  <span class="s2">&#34;routing&#34;</span><span class="err">:</span> <span class="p">{</span>
  <span class="err">//路由策略</span>
    <span class="nt">&#34;strategy&#34;</span><span class="p">:</span> <span class="s2">&#34;rules&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;rules&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;和上面的Email1一致&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;上面寫的tag1&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;和上面的Email2一致&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;上面寫的tag2&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="client">Client</h3>
<p>配置不同的uuid即可</p>
<h2 id="測試">測試</h2>
<p>[  4] local 10.82.1.54 port 5001 connected with  port 39390
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.0 sec  96.6 MBytes  80.8 Mbits/sec
[  5] local 10.82.1.54 port 5001 connected with  port 39398
[  5]  0.0-10.0 sec  93.4 MBytes  78.0 Mbits/sec
[  4] local 10.82.1.54 port 5001 connected with  port 39400
[  4]  0.0-10.0 sec   102 MBytes  84.9 Mbits/sec</p>
<h1 id="吐槽">吐槽</h1>
<p>英文單詞需要加s&hellip;</p>
<p>一定要记得</p>
<h1 id="contribute">contribute</h1>
<p><a href="https://toutyrater.github.io/">V2Ray 白话文教程</a>
<a href="https://v2ray.com">Project V</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
</feed>